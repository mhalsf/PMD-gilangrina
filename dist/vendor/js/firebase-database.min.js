!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).firebase)}(this,function(e){"use strict";try{(function(){function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function n(e,t){function n(){this.constructor=e}if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Oi(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function r(e,t,n,r){return new(n=n||Promise)(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(s,a)}u((r=r.apply(e,t||[])).next())})}function i(e,t){function n(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,(n=o?[2&n[0],o.value]:n)[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(o=0<(o=s.trys).length&&o[o.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var r,i,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a={next:n(0),throw:n(1),return:n(2)};return"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a}function o(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function a(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e}function u(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t}function l(e){return e=u(e),Fi.encodeByteArray(e,!0)}function h(e){try{return Fi.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}function c(e){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(var r in n)n.hasOwnProperty(r)&&p(r)&&(t[r]=e(t[r],n[r]));return t}(void 0,e)}function p(e){return"__proto__"!==e}function d(){var e=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(t,n){e.resolve=t,e.reject=n})}function f(){return"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function _(){return!0===Ai.NODE_ADMIN}function y(e,t,n){return t=Ni.call(this,t)||this,t.code=e,t.customData=n,t.name=ji,Object.setPrototypeOf(t,y.prototype),Error.captureStackTrace&&Error.captureStackTrace(t,Bi.prototype.create),t}function v(e,t,n){this.service=e,this.serviceName=t,this.errors=n}function g(e){return JSON.parse(e)}function m(e){return JSON.stringify(e)}function w(e){var t={},n={},r={},i="";try{var o=e.split(".");t=g(h(o[0])||""),n=g(h(o[1])||""),i=o[2],r=n.d||{};delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}}function C(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function b(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function T(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function E(e,t,n){var r,i={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function I(e){for(var t=[],n=0,r=Object.entries(e);n<r.length;n++){var i=r[n];!function(e,n){Array.isArray(n)?n.forEach(function(n){t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))}(i[0],i[1])}return t.length?"&"+t.join("&"):""}function S(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}function k(e,t,n,r){var i;if(r<t?i="at least "+t:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")}function P(e,t){return e+" failed: "+t+" argument "}function N(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(P(e,t)+"must be a valid function.")}function x(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(P(e,t)+"must be a valid context object.")}function R(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:55296<=r&&r<=56319?(t+=4,n++):t+=3}return t}function O(e){return e&&e._delegate?e._delegate:e}function D(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}function A(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}function L(e){this.name=e,this.providers=new Map}function M(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=(new Date).toISOString(),o=Xi[t];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[o].apply(console,a(["["+i+"]  "+e.name+":"],n))}}function F(e){this.name=e,this._logLevel=Ji,this._logHandler=M,this._userLogHandler=null}function q(e){eo=e}function W(e){this.domStorage_=e,this.prefix_="firebase:"}function j(){this.cache_={},this.isInMemoryStorage=!0}function U(e){var t=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i,o=e.charCodeAt(r);55296<=o&&o<=56319&&(i=o-55296,Li(++r<e.length,"Surrogate pair missing trail surrogate."),o=65536+(i<<10)+(e.charCodeAt(r)-56320)),o<128?t[n++]=o:(o<2048?t[n++]=o>>6|192:(o<65536?t[n++]=o>>12|224:(t[n++]=o>>18|240,t[n++]=o>>12&63|128),t[n++]=o>>6&63|128),t[n++]=63&o|128)}return t}(e);return(e=new zi).update(t),e=e.digest(),Fi.encodeByteArray(e)}function B(e,t){Li(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(so.logLevel=xi.VERBOSE,lo=so.log.bind(so),t&&oo.set("logging_enabled",!0)):"function"==typeof e?lo=e:(lo=null,oo.remove("logging_enabled"))}function V(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE INTERNAL ERROR: "+uo.apply(void 0,a([],s(e)));so.error(n)}function z(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)}function H(e,t){return e===t?0:e<t?-1:1}function Q(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+m(t))}function Y(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)n<i+t?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r}function K(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}function G(e){var t,n,r,i;Li(!z(e),"Invalid JSON number"),0===e?t=1/e==-1/(r=n=0)?1:0:(t=e<0,r=(e=Math.abs(e))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(e/Math.pow(2,-1074))));for(var o=[],s=52;s;--s)o.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;--s)o.push(n%2?1:0),n=Math.floor(n/2);o.push(t?1:0),o.reverse();var a=o.join(""),u="";for(s=0;s<64;s+=8){var l=parseInt(a.substr(s,8),2).toString(16);u+=l=1===l.length?"0"+l:l}return u.toLowerCase()}function $(e,t){return"object"==typeof(t=setTimeout(e,t))&&t.unref&&t.unref(),t}function J(e,t){var n=this;this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null!=t&&t.get().then(function(e){return n.appCheck=e})}function X(e,t,n){var r=this;this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(function(e){return r.auth_=e})}function Z(e){this.accessToken=e}function ee(e,t,n,r,i,o,s){void 0===i&&(i=!1),void 0===o&&(o=""),void 0===s&&(s=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=s,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=io.get("host:"+e)||this._host}function te(e,t,n){var r;if(Li("string"==typeof t,"typeof type must == string"),Li("object"==typeof n,"typeof params must == object"),t===No)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==xo)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}((t=e).host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams)&&(n.ns=e.namespace);var i=[];return K(n,function(e,t){i.push(e+"="+t)}),r+i.join("&")}function ne(){this.counters_={}}function re(e){return e=e.toString(),Do[e]||(Do[e]=new Oo),Do[e]}function ie(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}function oe(e,t,n,r,i,o,s){var a=this;this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=s,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=po(e),this.stats_=re(t),this.urlFn=function(e){return a.appCheckToken&&(e.ac=a.appCheckToken),te(t,xo,e)}}function se(e,t,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=ao(),window[Mo+this.uniqueCallbackIdentifier]=e,window[Fo+this.uniqueCallbackIdentifier]=t,this.myIFrame=se.createIFrame_(),t="",t="<html><body>"+(t=this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)?'<script>document.domain="'+document.domain+'";</script>':t)+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(t),this.myIFrame.doc.close()}catch(e){co("frame writing exception"),e.stack&&co(e.stack),co(e)}}function ae(e,t,n,r,i,o,s){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=po(this.connId),this.stats_=re(t),this.connURL=ae.connectionURL_(t,o,s,r),this.nodeAdmin=t.nodeAdmin}function ue(e){this.initTransports_(e)}function le(e,t,n,r,i,o,s,a,u,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=s,this.onDisconnect_=a,this.onKill_=u,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=po("c:"+this.id+":"),this.transportManager_=new Yo(t),this.log_("Connection created"),this.start_()}function he(){}function ce(e){this.allowedEvents_=e,this.listeners_={},Li(Array.isArray(e)&&0<e.length,"Requires a non-empty array")}function pe(){var e=Uo.call(this,["online"])||this;return e.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||f()||(window.addEventListener("online",function(){e.online_||(e.online_=!0,e.trigger("online",!0))},!1),window.addEventListener("offline",function(){e.online_&&(e.online_=!1,e.trigger("online",!1))},!1)),e}function de(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}function fe(){return new es("")}function _e(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function ye(e){return e.pieces_.length-e.pieceNum_}function ve(e){var t=e.pieceNum_;return t<e.pieces_.length&&t++,new es(e.pieces_,t)}function ge(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function me(e,t){return e.pieces_.slice(e.pieceNum_+(t=void 0===t?0:t))}function we(e){if(e.pieceNum_>=e.pieces_.length)return null;for(var t=[],n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new es(t,0)}function Ce(e,t){for(var n=[],r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof es)for(r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{var i=t.split("/");for(r=0;r<i.length;r++)0<i[r].length&&n.push(i[r])}return new es(n,0)}function be(e){return e.pieceNum_>=e.pieces_.length}function Te(e,t){var n=_e(e),r=_e(t);if(null===n)return t;if(n===r)return Te(ve(e),ve(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Ee(e,t){for(var n=me(e,0),r=me(t,0),i=0;i<n.length&&i<r.length;i++){var o=go(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1}function Ie(e,t){if(ye(e)!==ye(t))return!1;for(var n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function Se(e,t){var n=e.pieceNum_,r=t.pieceNum_;if(ye(e)>ye(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}function ke(e){if(e.byteLength_>Zo)throw new Error(e.errorPrefix_+"has a key path longer than "+Zo+" bytes ("+e.byteLength_+").");if(e.parts_.length>Xo)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Xo+") or object contains a cycle "+Pe(e))}function Pe(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}function Ne(){var e,t,n=Bo.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),n.visible_=!0,t&&document.addEventListener(t,function(){var t=!document[e];t!==n.visible_&&(n.visible_=t,n.trigger("visible",t))},!1),n}function xe(e,t,n,r,i,o,s,a){var u=Vo.call(this)||this;if(u.repoInfo_=e,u.applicationId_=t,u.onDataUpdate_=n,u.onConnectStatus_=r,u.onServerInfoUpdate_=i,u.authTokenProvider_=o,u.appCheckTokenProvider_=s,u.authOverride_=a,u.id=xe.nextPersistentConnectionId_++,u.log_=po("p:"+u.id+":"),u.interruptReasons_={},u.listens=new Map,u.outstandingPuts_=[],u.outstandingGets_=[],u.outstandingPutCount_=0,u.outstandingGetCount_=0,u.onDisconnectRequestQueue_=[],u.connected_=!1,u.reconnectDelay_=rs,u.maxReconnectDelay_=is,u.securityDebugCallback_=null,u.lastSessionId=null,u.establishConnectionTimer_=null,u.visible_=!1,u.requestCBHash_={},u.requestNumber_=0,u.realtime_=null,u.authToken_=null,u.appCheckToken_=null,u.forceTokenRefresh_=!1,u.invalidAuthTokenCount_=0,u.invalidAppCheckTokenCount_=0,u.firstConnection_=!0,u.lastConnectionAttemptTime_=null,u.lastConnectionEstablishedTime_=null,a&&!_())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return ns.getInstance().on("visible",u.onVisible_,u),-1===e.host.indexOf("fblocal")&&Jo.getInstance().on("online",u.onOnline_,u),u}function Re(e,t){this.name=e,this.node=t}function Oe(){}function De(){return null!==Ho&&Ho.apply(this,arguments)||this}function Ae(e,t,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!e.isEmpty();)if(o=t?n(e.key,t):1,r&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}function Le(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Le.RED,this.left=null!=r?r:gs.EMPTY_NODE,this.right=null!=i?i:gs.EMPTY_NODE}function Me(){}function Fe(e,t){void 0===t&&(t=Fe.EMPTY_NODE),this.comparator_=e,this.root_=t}function qe(e,t){return go(e.name,t.name)}function We(e,t){return go(e,t)}function je(e){return"number"==typeof e?"number:"+G(e):"string:"+e}function Ue(e,t){void 0===t&&(t=Ue.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Li(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),ms(this.priorityNode_)}function Be(){return null!==fs&&fs.apply(this,arguments)||this}function Ve(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/bs,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}function ze(e,t){this.indexes_=e,this.indexSet_=t}function He(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&ms(this.priorityNode_),this.children_.isEmpty()&&Li(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}function Qe(){return vs.call(this,new gs(We),ks.EMPTY_NODE,Ss.Default)||this}function Ye(e,t){if(void 0===t&&(t=null),null===e)return ks.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),Li(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"!=typeof(e="object"==typeof e&&".value"in e&&null!==e[".value"]?e[".value"]:e)||".sv"in e)return new ws(e,Ye(t));if(e instanceof Array||!Ns){var n=ks.EMPTY_NODE;return K(e,function(t,r){C(e,t)&&"."!==t.substring(0,1)&&(!(r=Ye(r)).isLeafNode()&&r.isEmpty()||(n=n.updateImmediateChild(t,r)))}),n.updatePriority(Ye(t))}var r=[],i=!1;if(K(e,function(e,t){"."!==e.substring(0,1)&&((t=Ye(t)).isEmpty()||(i=i||!t.getPriority().isEmpty(),r.push(new ss(e,t))))}),0===r.length)return ks.EMPTY_NODE;var o=Es(r,qe,function(e){return e.name},We);if(i){var s=Es(r,Cs.getCompare());return new ks(o,Ye(t),new Ss({".priority":s},{".priority":Cs}))}return new ks(o,Ye(t),Ss.Default)}function Ke(e){var t=xs.call(this)||this;return t.indexPath_=e,Li(!be(e)&&".priority"!==_e(e),"Can't create PathIndex with empty path or .priority key"),t}function Ge(){return null!==Rs&&Rs.apply(this,arguments)||this}function $e(e){if(e===""+bo)return"-";var t=To(e);if(null!=t)return""+(t+1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);if(n.length<786)return n.push("-"),n.join("");for(var i=n.length-1;0<=i&&"z"===n[i];)i--;return-1===i?vo:(t=n[i],t=qs.charAt(qs.indexOf(t)+1),n[i]=t,n.slice(0,i+1).join(""))}function Je(e){if(e===""+Co)return yo;var t=To(e);if(null!=t)return""+(t-1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);return"-"===n[n.length-1]?1===n.length?""+bo:(delete n[n.length-1],n.join("")):(n[n.length-1]=qs.charAt(qs.indexOf(n[n.length-1])-1),n.join("")+"z".repeat(786-n.length))}function Xe(e){return{type:"value",snapshotNode:e}}function Ze(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function et(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function tt(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}function nt(e){this.index_=e}function rt(e){this.indexedFilter_=new js(e.getIndex()),this.index_=e.getIndex(),this.startPost_=rt.getStartPost_(e),this.endPost_=rt.getEndPost_(e)}function it(e){this.rangedFilter_=new Us(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}function ot(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Cs}function st(e,t,n){return e=e.copy(),e.startSet_=!0,e.indexStartValue_=t=void 0===t?null:t,null!=n?(e.startNameSet_=!0,e.indexStartName_=n):(e.startNameSet_=!1,e.indexStartName_=""),e}function at(e,t,n){return e=e.copy(),e.endSet_=!0,e.indexEndValue_=t=void 0===t?null:t,void 0!==n?(e.endNameSet_=!0,e.indexEndName_=n):(e.endNameSet_=!1,e.indexEndName_=""),e}function ut(e,t){return e=e.copy(),e.index_=t,e}function lt(e){var t,n={};return e.isDefault()||(t=e.index_===Cs?"$priority":e.index_===Fs?"$value":e.index_===as?"$key":(Li(e.index_ instanceof Ms,"Unrecognized index type!"),e.index_.toString()),n.orderBy=m(t),e.startSet_&&(n.startAt=m(e.indexStartValue_),e.startNameSet_&&(n.startAt+=","+m(e.indexStartName_))),e.endSet_&&(n.endAt=m(e.indexEndValue_),e.endNameSet_&&(n.endAt+=","+m(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_)),n}function ht(e){var t,n={};return e.startSet_&&(n.sp=e.indexStartValue_,e.startNameSet_&&(n.sn=e.indexStartName_)),e.endSet_&&(n.ep=e.indexEndValue_,e.endNameSet_&&(n.en=e.indexEndName_)),e.limitSet_&&(n.l=e.limit_,""===(t=e.viewFrom_)&&(t=e.isViewFromLeft()?"l":"r"),n.vf=t),e.index_!==Cs&&(n.i=e.index_.toString()),n}function ct(e,t,n,r){var i=As.call(this)||this;return i.repoInfo_=e,i.onDataUpdate_=t,i.authTokenProvider_=n,i.appCheckTokenProvider_=r,i.log_=po("p:rest:"),i.listens_={},i}function pt(){this.rootNode_=ks.EMPTY_NODE}function dt(){return{value:null,children:new Map}}function ft(e,t,n){var r;be(t)?(e.value=n,e.children.clear()):null!==e.value?e.value=e.value.updateChild(t,n):(r=_e(t),e.children.has(r)||e.children.set(r,dt()),ft(e.children.get(r),t=ve(t),n))}function _t(e,t,n){var r;null!==e.value?n(t,e.value):(r=function(e,r){_t(r,new es(t.toString()+"/"+e),n)},e.children.forEach(function(e,t){r(t,e)}))}function yt(e){this.collection_=e,this.last_=null}function vt(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Qs(e),e=1e4+2e4*Math.random(),$(this.reportStats_.bind(this),Math.floor(e))}function gt(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function mt(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function wt(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}function Ct(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Ls.ACK_USER_WRITE,this.source=gt()}function bt(e,t){this.source=e,this.path=t,this.type=Ls.LISTEN_COMPLETE}function Tt(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Ls.OVERWRITE}function Et(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Ls.MERGE}function It(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}function St(e,t,n,r){var i=[],o=[];return t.forEach(function(t){var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))}),kt(e,i,"child_removed",t,r,n),kt(e,i,"child_added",t,r,n),kt(e,i,"child_moved",o,r,n),kt(e,i,"child_changed",t,r,n),kt(e,i,"value",t,r,n),i}function kt(e,t,n,r,i,o){r=r.filter(function(e){return e.type===n}),r.sort(function(t,n){return function(e,t,n){if(null==t.childName||null==n.childName)throw Mi("Should only compare child_ events.");return t=new ss(t.childName,t.snapshotNode),n=new ss(n.childName,n.snapshotNode),e.index_.compare(t,n)}(e,t,n)}),r.forEach(function(n){var r,s,a,u=(r=e,a=o,"value"===(s=n).type||"child_removed"===s.type||(s.prevName=a.getPredecessorChildName(s.childName,s.snapshotNode,r.index_)),s);i.forEach(function(r){r.respondsTo(n.type)&&t.push(r.createEvent(u,e.query_))})})}function Pt(e,t){return{eventCache:e,serverCache:t}}function Nt(e,t,n,r){return Pt(new _a(t,n,r),e.serverCache)}function xt(e,t,n,r){return Pt(e.eventCache,new _a(t,n,r))}function Rt(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Ot(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}function Dt(e,t){void 0===t&&(t=Ks=Ks||new gs(H)),this.value=e,this.children=t}function At(e){this.writeTree_=e}function Lt(e,t,n){if(be(t))return new ga(new va(n));var r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,o=r.value;r=Te(i,t),o=o.updateChild(r,n);return new ga(e.writeTree_.set(i,o))}return n=new va(n),n=e.writeTree_.setTree(t,n),new ga(n)}function Mt(e,t,n){var r=e;return K(n,function(e,n){r=Lt(r,Ce(t,e),n)}),r}function Ft(e,t){return be(t)?ga.empty():(t=e.writeTree_.setTree(t,new va(null)),new ga(t))}function qt(e,t){return null!=Wt(e,t)}function Wt(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Te(n.path,t)):null}function jt(e){var t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Cs,function(e,n){t.push(new ss(e,n))}):e.writeTree_.children.inorderTraversal(function(e,n){null!=n.value&&t.push(new ss(e,n.value))}),t}function Ut(e,t){if(be(t))return e;var n=Wt(e,t);return new ga(null!=n?new va(n):e.writeTree_.subtree(t))}function Bt(e){return e.writeTree_.isEmpty()}function Vt(e,t){return function e(t,n,r){if(null!=n.value)return r.updateChild(t,n.value);var i=null;return n.children.inorderTraversal(function(n,o){".priority"===n?(Li(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):r=e(Ce(t,n),o,r)}),r=r.getChild(t).isEmpty()||null===i?r:r.updateChild(Ce(t,".priority"),i)}(fe(),e.writeTree_,t)}function zt(e,t){return nn(t,e)}function Ht(e,t){var n=e.allWrites.findIndex(function(e){return e.writeId===t});Li(0<=n,"removeWrite called with nonexistent writeId.");var r=e.allWrites[n];e.allWrites.splice(n,1);for(var i,o=r.visible,s=!1,a=e.allWrites.length-1;o&&0<=a;){var u=e.allWrites[a];u.visible&&(n<=a&&function(e,t){if(e.snap)return Se(e.path,t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&Se(Ce(e.path,n),t))return!0;return!1}(u,r.path)?o=!1:Se(r.path,u.path)&&(s=!0)),a--}return!!o&&(s?((i=e).visibleWrites=Yt(i.allWrites,Qt,fe()),0<i.allWrites.length?i.lastWriteId=i.allWrites[i.allWrites.length-1].writeId:i.lastWriteId=-1):r.snap?e.visibleWrites=Ft(e.visibleWrites,r.path):K(r.children,function(t){e.visibleWrites=Ft(e.visibleWrites,Ce(r.path,t))}),!0)}function Qt(e){return e.visible}function Yt(e,t,n){for(var r=ga.empty(),i=0;i<e.length;++i){var o=e[i];if(t(o)){var s=o.path,a=void 0;if(o.snap)Se(n,s)?r=Lt(r,a=Te(n,s),o.snap):Se(s,n)&&(a=Te(s,n),r=Lt(r,fe(),o.snap.getChild(a)));else{if(!o.children)throw Mi("WriteRecord should have .snap or .children");Se(n,s)?r=Mt(r,a=Te(n,s),o.children):Se(s,n)&&(be(a=Te(s,n))?r=Mt(r,fe(),o.children):(o=b(o.children,_e(a)))&&(a=o.getChild(ve(a)),r=Lt(r,fe(),a)))}}}return r}function Kt(e,t,n,r,i){if(r||i){var o=Ut(e.visibleWrites,t);return!i&&Bt(o)?n:i||null!=n||qt(o,fe())?Vt(Yt(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(Se(e.path,t)||Se(t,e.path))},t),n||ks.EMPTY_NODE):null}return o=Wt(e.visibleWrites,t),null!=o?o:(e=Ut(e.visibleWrites,t),Bt(e)?n:null!=n||qt(e,fe())?Vt(e,n||ks.EMPTY_NODE):null)}function Gt(e,t,n,r){return Kt(e.writeTree,e.treePath,t,n,r)}function $t(e,t){return function(e,t,n){var r=ks.EMPTY_NODE,i=Wt(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(Cs,function(e,t){r=r.updateImmediateChild(e,t)}),r;if(n){var o=Ut(e.visibleWrites,t);return n.forEachChild(Cs,function(e,t){t=Vt(Ut(o,new es(e)),t),r=r.updateImmediateChild(e,t)}),jt(o).forEach(function(e){r=r.updateImmediateChild(e.name,e.node)}),r}return jt(Ut(e.visibleWrites,t)).forEach(function(e){r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function Jt(e,t,n,r){return i=e.writeTree,e=e.treePath,t=t,r=r,Li(n||r,"Either existingEventSnap or existingServerSnap must exist"),e=Ce(e,t),qt(i.visibleWrites,e)?null:Bt(e=Ut(i.visibleWrites,e))?r.getChild(t):Vt(e,r.getChild(t));var i}function Xt(e,t){return n=e.writeTree,t=Ce(e.treePath,t),Wt(n.visibleWrites,t);var n}function Zt(e,t,n,r,i,o){return function(e,t,n,r,i,o,s){var a;e=Ut(e.visibleWrites,t);if(null!=(t=Wt(e,fe())))a=t;else{if(null==n)return[];a=Vt(e,n)}if((a=a.withIndex(s)).isEmpty()||a.isLeafNode())return[];for(var u=[],l=s.getCompare(),h=o?a.getReverseIteratorFrom(r,s):a.getIteratorFrom(r,s),c=h.getNext();c&&u.length<i;)0!==l(c,r)&&u.push(c),c=h.getNext();return u}(e.writeTree,e.treePath,t,n,r,i,o)}function en(e,t,n){return r=e.writeTree,i=e.treePath,e=n,t=Ce(i,n=t),null!=(i=Wt(r.visibleWrites,t))?i:e.isCompleteForChild(n)?Vt(Ut(r.visibleWrites,t),e.getNode().getImmediateChild(n)):null;var r,i}function tn(e,t){return nn(Ce(e.treePath,t),e.writeTree)}function nn(e,t){return{treePath:e,writeTree:t}}function rn(){this.changeMap=new Map}function on(){}function sn(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}function an(e,t,n,r,i){var o,s,a,u,l,h,c,p,d=new ma;if(n.type===Ls.OVERWRITE)var f=n,_=f.source.fromUser?hn(e,t,f.path,f.snap,r,i,d):(Li(f.source.fromServer,"Unknown source."),o=f.source.tagged||t.serverCache.isFiltered()&&!be(f.path),ln(e,t,f.path,f.snap,r,i,o,d));else if(n.type===Ls.MERGE){var y=n;_=y.source.fromUser?(s=e,a=t,u=y.path,f=y.children,l=r,h=i,c=d,p=a,f.foreach(function(e,t){e=Ce(u,e),cn(a,_e(e))&&(p=hn(s,p,e,t,l,h,c))}),f.foreach(function(e,t){e=Ce(u,e),cn(a,_e(e))||(p=hn(s,p,e,t,l,h,c))}),p):(Li(y.source.fromServer,"Unknown source."),o=y.source.tagged||t.serverCache.isFiltered(),dn(e,t,y.path,y.children,r,i,o,d))}else if(n.type===Ls.ACK_USER_WRITE){var v=n;_=v.revert?function(e,t,n,r,i,o){var s;if(null!=Xt(r,n))return t;var a,u,l=new Ca(r,t,i),h=t.eventCache.getNode();i=void 0;return be(n)||".priority"===_e(n)?(u=void 0,u=t.serverCache.isFullyInitialized()?Gt(r,Ot(t)):(a=t.serverCache.getNode(),Li(a instanceof ks,"serverChildren would be complete if leaf node"),$t(r,a)),i=e.filter.updateFullNode(h,u,o)):(a=_e(n),null==(u=en(r,a,t.serverCache))&&t.serverCache.isCompleteForChild(a)&&(u=h.getImmediateChild(a)),(i=null!=u?e.filter.updateChild(h,a,u,ve(n),l,o):t.eventCache.getNode().hasChild(a)?e.filter.updateChild(h,a,ks.EMPTY_NODE,ve(n),l,o):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(s=Gt(r,Ot(t))).isLeafNode()&&(i=e.filter.updateFullNode(i,s,o))),s=t.serverCache.isFullyInitialized()||null!=Xt(r,fe()),Nt(t,i,s,e.filter.filtersNodes())}(e,t,v.path,r,i,d):function(e,t,n,r,i,o,s){if(null!=Xt(i,n))return t;var a=t.serverCache.isFiltered(),u=t.serverCache;if(null!=r.value){if(be(n)&&u.isFullyInitialized()||u.isCompleteForPath(n))return ln(e,t,n,u.getNode().getChild(n),i,o,a,s);if(be(n)){var l=new va(null);return u.getNode().forEachChild(as,function(e,t){l=l.set(new es(e),t)}),dn(e,t,n,l,i,o,a,s)}return t}var h=new va(null);return r.foreach(function(e,t){var r=Ce(n,e);u.isCompleteForPath(r)&&(h=h.set(e,u.getNode().getChild(r)))}),dn(e,t,n,h,i,o,a,s)}(e,t,v.path,v.affectedTree,r,i,d)}else{if(n.type!==Ls.LISTEN_COMPLETE)throw Mi("Unknown operation type: "+n.type);v=e,i=n.path,e=r,n=d,r=xt(t,(r=t.serverCache).getNode(),r.isFullyInitialized()||be(i),r.isFiltered()),_=un(v,r,i,e,wa,n)}return d=d.getChanges(),function(e,t,n){var r,i,o=t.eventCache;o.isFullyInitialized()&&(r=o.getNode().isLeafNode()||o.getNode().isEmpty(),i=Rt(e),(0<n.length||!e.eventCache.isFullyInitialized()||r&&!o.getNode().equals(i)||!o.getNode().getPriority().equals(i.getPriority()))&&n.push(Xe(Rt(t))))}(t,_,d),{viewCache:_,changes:d}}function un(e,t,n,r,i,o){var s=t.eventCache;if(null!=Xt(r,n))return t;var a,u,l,h,c=void 0,p=void 0;return c=be(n)?(Li(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),
t.serverCache.isFiltered()?(a=$t(r,(a=Ot(t))instanceof ks?a:ks.EMPTY_NODE),e.filter.updateFullNode(t.eventCache.getNode(),a,o)):(u=Gt(r,Ot(t)),e.filter.updateFullNode(t.eventCache.getNode(),u,o))):".priority"===(u=_e(n))?(Li(1===ye(n),"Can't have a priority with additional path components"),null!=(h=Jt(r,n,l=s.getNode(),p=t.serverCache.getNode()))?e.filter.updatePriority(l,h):s.getNode()):(l=ve(n),h=void 0,null!=(h=s.isCompleteForChild(u)?(p=t.serverCache.getNode(),null!=(p=Jt(r,n,s.getNode(),p))?s.getNode().getImmediateChild(u).updateChild(l,p):s.getNode().getImmediateChild(u)):en(r,u,t.serverCache))?e.filter.updateChild(s.getNode(),u,h,l,i,o):s.getNode()),Nt(t,c,s.isFullyInitialized()||be(n),e.filter.filtersNodes())}function ln(e,t,n,r,i,o,s,a){var u=t.serverCache,l=s?e.filter:e.filter.getIndexedFilter();if(be(n))c=l.updateFullNode(u.getNode(),r,null);else if(l.filtersNodes()&&!u.isFiltered())var h=u.getNode().updateChild(n,r),c=l.updateFullNode(u.getNode(),h,null);else{if(s=_e(n),!u.isCompleteForPath(n)&&1<ye(n))return t;h=ve(n),r=u.getNode().getImmediateChild(s).updateChild(h,r),c=".priority"===s?l.updatePriority(u.getNode(),r):l.updateChild(u.getNode(),s,r,h,wa,null)}return l=xt(t,c,u.isFullyInitialized()||be(n),l.filtersNodes()),un(e,l,n,i,new Ca(i,l,o),a)}function hn(e,t,n,r,i,o,s){var a,u,l=t.eventCache,h=new Ca(i,t,o);return be(n)?(u=e.filter.updateFullNode(t.eventCache.getNode(),r,s),Nt(t,u,!0,e.filter.filtersNodes())):".priority"===(a=_e(n))?(u=e.filter.updatePriority(t.eventCache.getNode(),r),Nt(t,u,l.isFullyInitialized(),l.isFiltered())):(i=ve(n),o=l.getNode().getImmediateChild(a),u=void 0,u=be(i)?r:null!=(n=h.getCompleteChild(a))?".priority"===ge(i)&&n.getChild(we(i)).isEmpty()?n:n.updateChild(i,r):ks.EMPTY_NODE,o.equals(u)?t:Nt(t,e.filter.updateChild(l.getNode(),a,u,i,h,s),l.isFullyInitialized(),e.filter.filtersNodes()))}function cn(e,t){return e.eventCache.isCompleteForChild(t)}function pn(e,t,n){return n.foreach(function(e,n){t=t.updateChild(e,n)}),t}function dn(e,t,n,r,i,o,s,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;var u=t,l=(r=be(n)?r:new va(null).setTree(n,r),t.serverCache.getNode());return r.children.inorderTraversal(function(n,r){l.hasChild(n)&&(r=pn(0,t.serverCache.getNode().getImmediateChild(n),r),u=ln(e,u,new es(n),r,i,o,s,a))}),r.children.inorderTraversal(function(n,r){var h=!t.serverCache.isCompleteForChild(n)&&void 0===r.value;l.hasChild(n)||h||(r=pn(0,t.serverCache.getNode().getImmediateChild(n),r),u=ln(e,u,new es(n),r,i,o,s,a))}),u}function fn(e,t){this.query_=e,this.eventRegistrations_=[];var n=this.query_._queryParams,r=new js(n.getIndex()),i=(o=n).loadsAllData()?new js(o.getIndex()):new(o.hasLimit()?Bs:Us)(o);this.processor_={filter:i};e=t.serverCache,n=t.eventCache;var o=r.updateFullNode(ks.EMPTY_NODE,e.getNode(),null);t=i.updateFullNode(ks.EMPTY_NODE,n.getNode(),null),r=new _a(o,e.isFullyInitialized(),r.filtersNodes()),i=new _a(t,n.isFullyInitialized(),i.filtersNodes());this.viewCache_=Pt(i,r),this.eventGenerator_=new ya(this.query_)}function _n(e){return 0===e.eventRegistrations_.length}function yn(e,t,n){var r,i=[];if(n&&(Li(null==t,"A cancel should cancel all event registrations."),r=e.query._path,e.eventRegistrations_.forEach(function(e){e=e.createCancelEvent(n,r),e&&i.push(e)})),t){for(var o=[],s=0;s<e.eventRegistrations_.length;++s){var a=e.eventRegistrations_[s];if(a.matches(t)){if(t.hasAnyCallback()){o=o.concat(e.eventRegistrations_.slice(s+1));break}}else o.push(a)}e.eventRegistrations_=o}else e.eventRegistrations_=[];return i}function vn(e,t,n,r){t.type===Ls.MERGE&&null!==t.source.queryId&&(Li(Ot(e.viewCache_),"We should always have a full cache before handling merges"),Li(Rt(e.viewCache_),"Missing event cache, even though we have a server cache"));var i=e.viewCache_;t=an(e.processor_,i,t,n,r);return n=e.processor_,r=t.viewCache,Li(r.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),Li(r.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed"),Li(t.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=t.viewCache,gn(e,t.changes,t.viewCache.eventCache.getNode(),null)}function gn(e,t,n,r){return r=r?[r]:e.eventRegistrations_,St(e.eventGenerator_,t,n,r)}function mn(e,t,n,r){var i,s,a=t.source.queryId;if(null!==a){var u=e.views.get(a);return Li(null!=u,"SyncTree gave us an op for an invalid query."),vn(u,t,n,r)}var l=[];try{for(var h=o(e.views.values()),c=h.next();!c.done;c=h.next())u=c.value,l=l.concat(vn(u,t,n,r))}catch(e){i={error:e}}finally{try{c&&!c.done&&(s=h.return)&&s.call(h)}finally{if(i)throw i.error}}return l}function wn(e,t,n,r,i){var o=t._queryIdentifier;e=e.views.get(o);return e||(o=Gt(n,i?r:null),e=!1,e=!!o||(o=r instanceof ks?$t(n,r):ks.EMPTY_NODE,!1),i=Pt(new _a(o,e,!1),new _a(r,i,!1)),new ba(t,i))}function Cn(e,t,n,r,i,o){var s;o=wn(e,t,r,i,o);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),o.eventRegistrations_.push(n),t=n,o=(n=o).viewCache_.eventCache,s=[],o.getNode().isLeafNode()||o.getNode().forEachChild(Cs,function(e,t){s.push(Ze(e,t))}),o.isFullyInitialized()&&s.push(Xe(o.getNode())),gn(n,s,o.getNode(),t)}function bn(e,t,n,r){var i,a,u=t._queryIdentifier,l=[],h=[],c=kn(e);if("default"===u)try{for(var p=o(e.views.entries()),d=p.next();!d.done;d=p.next()){var f=s(d.value,2),_=f[0],y=f[1];h=h.concat(yn(y,n,r));_n(y)&&(e.views.delete(_),y.query._queryParams.loadsAllData()||l.push(y.query))}}catch(e){i={error:e}}finally{try{d&&!d.done&&(a=p.return)&&a.call(p)}finally{if(i)throw i.error}}else(y=e.views.get(u))&&(h=h.concat(yn(y,n,r)),_n(y)&&(e.views.delete(u),y.query._queryParams.loadsAllData()||l.push(y.query)));return c&&!kn(e)&&l.push((Li(Gs,"Reference.ts has not been loaded"),new Gs(t._repo,t._path))),{removed:l,events:h}}function Tn(e){var t,n,r=[];try{for(var i=o(e.views.values()),s=i.next();!s.done;s=i.next()){var a=s.value;a.query._queryParams.loadsAllData()||r.push(a)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function En(e,t){var n,r,i,s,a,u=null;try{for(var l=o(e.views.values()),h=l.next();!h.done;h=l.next()){var c=h.value;u=u||(s=t,a=void 0,(a=Ot((i=c).viewCache_))&&(i.query._queryParams.loadsAllData()||!be(s)&&!a.getImmediateChild(_e(s)).isEmpty())?a.getChild(s):null)}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return u}function In(e,t){return t._queryParams.loadsAllData()?Pn(e):(t=t._queryIdentifier,e.views.get(t))}function Sn(e,t){return null!=In(e,t)}function kn(e){return null!=Pn(e)}function Pn(e){var t,n;try{for(var r=o(e.views.values()),i=r.next();!i.done;i=r.next()){var s=i.value;if(s.query._queryParams.loadsAllData())return s}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return null}function Nn(e,t,n,r,i){var o,s,a,u;return o=e.pendingWriteTree_,s=t,a=n,u=i,Li((r=r)>o.lastWriteId,"Stacking an older write on top of newer ones"),o.allWrites.push({path:s,snap:a,writeId:r,visible:u=void 0===u||u}),u&&(o.visibleWrites=Lt(o.visibleWrites,s,a)),o.lastWriteId=r,i?Fn(e,new da(gt(),t,n)):[]}function xn(e,t,n,r){var i,o,s;return i=e.pendingWriteTree_,o=t,s=n,Li((r=r)>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:o,children:s,writeId:r,visible:!0}),i.visibleWrites=Mt(i.visibleWrites,o,s),i.lastWriteId=r,n=va.fromObject(n),Fn(e,new fa(gt(),t,n))}function Rn(e,t,n){void 0===n&&(n=!1);var r=function(e,t){for(var n=0;n<e.allWrites.length;n++){var r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(Ht(e.pendingWriteTree_,t)){var i=new va(null);return null!=r.snap?i=i.set(fe(),!0):K(r.children,function(e){i=i.set(new es(e),!0)}),Fn(e,new ca(r.path,i,n))}return[]}function On(e,t,n){return Fn(e,new da(mt(),t,n))}function Dn(e,t,n,r){var i=t._path,o=e.syncPointTree_.get(i),s=[];if(o&&("default"===t._queryIdentifier||Sn(o,t))){var a=bn(o,t,n,r);if(0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(i)),n=a.removed,s=a.events,o=-1!==n.findIndex(function(e){return e._queryParams.loadsAllData()}),a=e.syncPointTree_.findOnPath(i,function(e,t){return kn(t)}),o&&!a&&(i=e.syncPointTree_.subtree(i),!i.isEmpty()))for(var u=i.fold(function(e,t,n){if(t&&kn(t))return[Pn(t)];var r=[];return t&&(r=Tn(t)),K(n,function(e,t){r=r.concat(t)}),r}),l=0;l<u.length;++l){var h=u[l],c=h.query;h=Wn(e,h);e.listenProvider_.startListening(Hn(c),jn(e,c),h.hashFn,h.onComplete)}!a&&0<n.length&&!r&&(o?e.listenProvider_.stopListening(Hn(t),null):n.forEach(function(t){var n=e.queryToTagMap.get(Un(t));e.listenProvider_.stopListening(Hn(t),n)})),function(e,t){for(var n=0;n<t.length;++n){var r,i=t[n];i._queryParams.loadsAllData()||(r=Un(i),i=e.queryToTagMap.get(r),e.queryToTagMap.delete(r),e.tagToQueryMap.delete(i))}}(e,n)}return s}function An(e,t,n){var r=t._path,i=null,o=!1;e.syncPointTree_.foreachOnPath(r,function(e,t){e=Te(e,r),i=i||En(t,e),o=o||kn(t)});var s=e.syncPointTree_.get(r);s?(o=o||kn(s),i=i||En(s,fe())):(s=new Ta,e.syncPointTree_=e.syncPointTree_.set(r,s)),null!=i?h=!0:(h=!1,i=ks.EMPTY_NODE,e.syncPointTree_.subtree(r).foreachChild(function(e,t){t=En(t,fe()),t&&(i=i.updateImmediateChild(e,t))}));var a,u,l=Sn(s,t);l||t._queryParams.loadsAllData()||(a=Un(t),Li(!e.queryToTagMap.has(a),"View does not exist, but we have a tag"),u=Ea++,e.queryToTagMap.set(a,u),e.tagToQueryMap.set(u,a));var h=Cn(s,t,n,zt(e.pendingWriteTree_,r),i,h);return l||o||(s=In(s,t),h=h.concat(function(e,t,n){var r=t._path,i=jn(e,t);n=Wn(e,n),n=e.listenProvider_.startListening(Hn(t),i,n.hashFn,n.onComplete),r=e.syncPointTree_.subtree(r);if(i)Li(!kn(r.value),"If we're adding a query, it shouldn't be shadowed");else for(var o=r.fold(function(e,t,n){if(!be(e)&&t&&kn(t))return[Pn(t).query];var r=[];return t&&(r=r.concat(Tn(t).map(function(e){return e.query}))),K(n,function(e,t){r=r.concat(t)}),r}),s=0;s<o.length;++s){var a=o[s];e.listenProvider_.stopListening(Hn(a),jn(e,a))}return n}(e,t,s))),h}function Ln(e,t,n){var r=e.pendingWriteTree_;e=e.syncPointTree_.findOnPath(t,function(e,n){if(e=En(n,Te(e,t)),e)return e});return Kt(r,t,e,n,!0)}function Mn(e,t){var n=t._path,r=null;e.syncPointTree_.foreachOnPath(n,function(e,t){e=Te(e,n),r=r||En(t,e)});var i=e.syncPointTree_.get(n);i?r=r||En(i,fe()):(i=new Ta,e.syncPointTree_=e.syncPointTree_.set(n,i));var o=null!=r,s=o?new _a(r,!0,!1):null;return Rt(wn(i,t,zt(e.pendingWriteTree_,t._path),o?s.getNode():ks.EMPTY_NODE,o).viewCache_)}function Fn(e,t){return function e(t,n,r,i){if(be(t.path))return qn(t,n,r,i);var o=n.get(fe());null==r&&null!=o&&(r=En(o,fe()));var s=[],a=_e(t.path),u=t.operationForChild(a),l=n.children.get(a);return l&&u&&(n=r?r.getImmediateChild(a):null,a=tn(i,a),s=s.concat(e(u,l,n,a))),o?s.concat(mn(o,t,i,r)):s}(t,e.syncPointTree_,null,zt(e.pendingWriteTree_,fe()))}function qn(e,t,n,r){var i=t.get(fe());null==n&&null!=i&&(n=En(i,fe()));var o=[];return t.children.inorderTraversal(function(t,i){var s=n?n.getImmediateChild(t):null,a=tn(r,t);t=e.operationForChild(t);t&&(o=o.concat(qn(t,i,s,a)))}),o=i?o.concat(mn(i,e,r,n)):o}function Wn(e,t){var n=t.query,r=jn(e,n);return{hashFn:function(){return(t.viewCache_.serverCache.getNode()||ks.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?function(e,t,n){var r=Bn(e,n);return r?(n=Vn(r),r=n.path,n=n.queryId,t=Te(r,t),zn(e,r,new pa(wt(n),t))):[]}(e,n._path,r):(i=n._path,Fn(e,new pa(mt(),i)));var i=(i="Unknown Error","too_big"===(t=t)?i="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?i="Client doesn't have permission to access the desired data.":"unavailable"===t&&(i="The service is unavailable"),(i=new Error(t+" at "+n._path.toString()+": "+i)).code=t.toUpperCase(),i);return Dn(e,n,null,i)}}}function jn(e,t){return t=Un(t),e.queryToTagMap.get(t)}function Un(e){return e._path.toString()+"$"+e._queryIdentifier}function Bn(e,t){return e.tagToQueryMap.get(t)}function Vn(e){var t=e.indexOf("$");return Li(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new es(e.substr(0,t))}}function zn(e,t,n){var r=e.syncPointTree_.get(t);return Li(r,"Missing sync point for query tag that we're tracking"),mn(r,n,zt(e.pendingWriteTree_,t),null)}function Hn(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?(Li($s,"Reference.ts has not been loaded"),new $s(e._repo,e._path)):e}function Qn(e){this.node_=e}function Yn(e,t){this.syncTree_=e,this.path_=t}function Kn(e,t,n){var r=e.getPriority().val(),i=Na(r,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var o=e;r=Na(o.getValue(),t,n);return r!==o.getValue()||i!==o.getPriority().val()?new ws(r,Ye(i)):e}e=e;var s=e;return i!==e.getPriority().val()&&(s=s.updatePriority(new ws(i))),e.forEachChild(Cs,function(e,r){var i=Kn(r,t.getImmediateChild(e),n);i!==r&&(s=s.updateImmediateChild(e,i))}),s}function Gn(e,t){for(var n=t instanceof es?t:new es(t),r=e,i=_e(n);null!==i;){var o=b(r.node.children,i)||{children:{},childCount:0};r=new Aa(i,r,o),i=_e(n=ve(n))}return r}function $n(e){return e.node.value}function Jn(e,t){e.node.value=t,tr(e)}function Xn(e){return 0<e.node.childCount}function Zn(e,t){K(e.node.children,function(n,r){t(new Aa(n,e,r))})}function er(e){return new es(null===e.parent?e.name:er(e.parent)+"/"+e.name)}function tr(e){var t,n,r,i;null!==e.parent&&(t=e.parent,n=e.name,i=function(e){return void 0===$n(e)&&!Xn(e)}(r=e),e=C(t.node.children,n),i&&e?(delete t.node.children[n],t.node.childCount--,tr(t)):i||e||(t.node.children[n]=r.node,t.node.childCount++,tr(t)))}function nr(e){return"string"==typeof e&&0!==e.length&&!La.test(e)}function rr(e){return"string"==typeof e&&0!==e.length&&!Ma.test(e)}function ir(e,t,n,r){if(!r||void 0!==t){var i=P(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");var o=[];K(t,function(e,t){if(e=new es(e),ja(i,t,Ce(n,e)),".priority"===ge(e)&&!qa(t))throw new Error(i+"contains an invalid value for '"+e.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");o.push(e)}),function(e,t){for(var n=0;n<t.length;n++)for(var r,i=me(r=t[n]),o=0;o<i.length;o++)if((".priority"!==i[o]||o!==i.length-1)&&!nr(i[o]))throw new Error(e+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(Ee);var s=null;for(n=0;n<t.length;n++){if(r=t[n],null!==s&&Se(s,r))throw new Error(e+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}}(i,o)}}function or(e,t,n){if(!n||void 0!==t){if(z(t))throw new Error(P(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!qa(t))throw new Error(P(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function sr(e,t,n,r){if(!(r&&void 0===n||nr(n)))throw new Error(P(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function ar(e,t){for(var n=null,r=0;r<t.length;r++){var i=t[r],o=i.getPath();null===n||Ie(o,n.path)||(e.eventLists_.push(n),n=null),(n=null===n?{events:[],path:o}:n).events.push(i)}n&&e.eventLists_.push(n)}function ur(e,t,n){ar(e,n),hr(e,function(e){return Ie(e,t)})}function lr(e,t,n){ar(e,n),hr(e,function(e){return Se(e,t)||Se(t,e)})}function hr(e,t){e.recursionDepth_++;for(var n=!0,r=0;r<e.eventLists_.length;r++){var i=e.eventLists_[r];i&&(t(i.path)?(function(e){for(var t=0;t<e.events.length;t++){var n,r=e.events[t];null!==r&&(e.events[t]=null,n=r.getEventRunner(),lo&&co("event: "+r.toString()),Eo(n))}}(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}function cr(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ha,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=dt(),this.transactionQueueTree_=new Aa,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}function pr(e,t,n){if(e.stats_=re(e.repoInfo_),e.forceRestClient_||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))e.server_=new zs(e.repoInfo_,function(t,n,r,i){_r(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(function(){return yr(e,!0)},0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{m(n)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}e.persistentConnection_=new os(e.repoInfo_,t,function(t,n,r,i){_r(e,t,n,r,i)},function(t){yr(e,t)},function(t){var n;n=e,K(t,function(e,t){vr(n,e,t)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(function(t){e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(function(t){e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=(t=e.repoInfo_,n=function(){return new Ys(e.stats_,e.server_)},t=t.toString(),Ao[t]||(Ao[t]=n()),Ao[t]),e.infoData_=new Hs,e.infoSyncTree_=new Ia({startListening:function(t,n,r,i){var o=[],s=e.infoData_.getNode(t._path);return s.isEmpty()||(o=On(e.infoSyncTree_,t._path,s),setTimeout(function(){i("ok")},0)),o},stopListening:function(){}}),vr(e,"connected",!1),e.serverSyncTree_=new Ia({startListening:function(t,n,r,i){return e.server_.listen(t,r,n,function(n,r){r=i(n,r),lr(e.eventQueue_,t._path,r)}),[]},stopListening:function(t,n){e.server_.unlisten(t,n)}})}function dr(e){return e=e.infoData_.getNode(new es(".info/serverTimeOffset")).val()||0,(new Date).getTime()+e}function fr(e){return Pa({timestamp:dr(e)})}function _r(e,t,n,r,i){e.dataUpdateCount++;var o=new es(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;var s,a,u,l,h=[];t=o;0<(h=i?r?(s=E(n,function(e){return Ye(e)}),function(e,t,n,r){var i=Bn(e,r);return i?(r=Vn(i),i=r.path,r=r.queryId,t=Te(i,t),n=va.fromObject(n),zn(e,i,new fa(wt(r),t,n))):[]}(e.serverSyncTree_,o,s,i)):(l=Ye(n),s=e.serverSyncTree_,a=o,u=l,null==(i=Bn(s,l=i))?[]:(l=Vn(i),i=l.path,l=l.queryId,a=Te(i,a),zn(s,i,new da(wt(l),a,u)))):r?(l=E(n,function(e){return Ye(e)}),a=e.serverSyncTree_,u=o,r=l,r=va.fromObject(l),Fn(a,new fa(mt(),u,r))):(n=Ye(n),On(e.serverSyncTree_,o,n))).length&&(t=Pr(e,o)),lr(e.eventQueue_,t,h)}function yr(e,t){vr(e,"connected",t),!1===t&&function(e){Er(e,"onDisconnectEvents");var t=fr(e),n=dt();_t(e.onDisconnect_,fe(),function(r,i){i=Oa(r,i,e.serverSyncTree_,t),ft(n,r,i)});var r=[];_t(n,fe(),function(t,n){r=r.concat(On(e.serverSyncTree_,t,n)),t=Or(e,t),Pr(e,t)}),e.onDisconnect_=dt(),lr(e.eventQueue_,fe(),r)}(e)}function vr(e,t,n){t=new es("/.info/"+t),n=Ye(n),e.infoData_.updateSnapshot(t,n),n=On(e.infoSyncTree_,t,n),lr(e.eventQueue_,t,n)}function gr(e){return e.nextWriteId_++}function mr(e,t,n,r,i){Er(e,"set",{path:t.toString(),value:n,priority:r});var o=fr(e),s=(n=Ye(n,r),r=Ln(e.serverSyncTree_,t),o=Da(n,r,o),gr(e));o=Nn(e.serverSyncTree_,t,o,s,!0);ar(e.eventQueue_,o),e.server_.put(t.toString(),n.val(!0),function(n,r){var o="ok"===n;o||_o("set at "+t+" failed: "+n),o=Rn(e.serverSyncTree_,s,!o),lr(e.eventQueue_,t,o),Ir(0,i,n,r)}),n=Or(e,t),Pr(e,n),lr(e.eventQueue_,n,[])}function wr(e,t,n){e.server_.onDisconnectCancel(t.toString(),function(r,i){"ok"===r&&function e(t,n){if(be(n))return t.value=null,t.children.clear(),!0;if(null!==t.value){if(t.value.isLeafNode())return!1;var r=t.value;return t.value=null,r.forEachChild(Cs,function(e,n){ft(t,new es(e),n)}),e(t,n)}return!(0<t.children.size)||(r=_e(n),n=ve(n),t.children.has(r)&&e(t.children.get(r),n)&&t.children.delete(r),0===t.children.size)}(e.onDisconnect_,t),Ir(0,n,r,i)})}function Cr(e,t,n,r){var i=Ye(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),function(n,o){"ok"===n&&ft(e.onDisconnect_,t,i),Ir(0,r,n,o)})}function br(e,t,n){n=".info"===_e(t._path)?Dn(e.infoSyncTree_,t,n):Dn(e.serverSyncTree_,t,n),ur(e.eventQueue_,t._path,n)}function Tr(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Qa)}function Er(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r="";e.persistentConnection_&&(r=e.persistentConnection_.id+":"),co.apply(void 0,a([r],s(t)))}function Ir(e,t,n,r){t&&Eo(function(){var e,i;"ok"===n?t(null):(i=e=(n||"error").toUpperCase(),r&&(i+=": "+r),(i=new Error(i)).code=e,t(i))})}function Sr(e,t,n){return Ln(e.serverSyncTree_,t,n)||ks.EMPTY_NODE}function kr(e,t){var n;(t=void 0===t?e.transactionQueueTree_:t)||Rr(e,t),$n(t)?(n=xr(e,t),Li(0<n.length,"Sending zero length transaction queue"),n.every(function(e){return 0===e.status})&&function(e,t,n){for(var r=n.map(function(e){return e.currentWriteId}),i=Sr(e,t,r),o=i,s=(r=i.hash(),0);s<n.length;s++){var a=n[s];Li(0===a.status,"tryToSendTransactionQueue_: items in queue should all be run."),a.status=1,a.retryCount++;var u=Te(t,a.path);o=o.updateChild(u,a.currentOutputSnapshotRaw)}i=o.val(!0);var l=t;e.server_.put(l.toString(),i,function(r){Er(e,"transaction put response",{path:l.toString(),status:r});var i=[];if("ok"===r){for(var o=[],s=0;s<n.length;s++)!function(t){n[t].status=2,i=i.concat(Rn(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&o.push(function(){return n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)}),n[t].unwatcher()}(s);for(Rr(e,Gn(e.transactionQueueTree_,t)),kr(e,e.transactionQueueTree_),lr(e.eventQueue_,t,i),s=0;s<o.length;s++)Eo(o[s])}else{if("datastale"===r)for(s=0;s<n.length;s++)3===n[s].status?n[s].status=4:n[s].status=0;else for(_o("transaction at "+l.toString()+" failed: "+r),s=0;s<n.length;s++)n[s].status=4,n[s].abortReason=r;Pr(e,t)}},r)}(e,er(t),n)):Xn(t)&&Zn(t,function(t){kr(e,t)})}function Pr(e,t){var n=Nr(e,t);t=er(n);return function(e,t,n){if(0!==t.length){for(var r=[],i=[],o=t.filter(function(e){return 0===e.status}).map(function(e){return e.currentWriteId}),s=0;s<t.length;s++)!function(s){var a,u,l,h,c=t[s],p=Te(n,c.path),d=!1;Li(null!==p,"rerunTransactionsUnderNode_: relativePath should not be null."),4===c.status?(a=c.abortReason,i=i.concat(Rn(e.serverSyncTree_,c.currentWriteId,d=!0))):0===c.status&&(i=c.retryCount>=Ya?(a="maxretry",i.concat(Rn(e.serverSyncTree_,c.currentWriteId,d=!0))):(u=Sr(e,c.path,o),c.currentInputSnapshot=u,void 0!==(h=t[s].update(u.val()))?(ja("transaction failed: Data returned ",h,c.path),l=Ye(h),"object"==typeof h&&null!=h&&C(h,".priority")||(l=l.updatePriority(u.getPriority())),p=c.currentWriteId,h=fr(e),h=Da(l,u,h),c.currentOutputSnapshotRaw=l,c.currentOutputSnapshotResolved=h,c.currentWriteId=gr(e),o.splice(o.indexOf(p),1),(i=i.concat(Nn(e.serverSyncTree_,c.path,h,c.currentWriteId,c.applyLocally))).concat(Rn(e.serverSyncTree_,p,!0))):(a="nodata",i.concat(Rn(e.serverSyncTree_,c.currentWriteId,d=!0))))),lr(e.eventQueue_,n,i),i=[],d&&(t[s].status=2,d=t[s].unwatcher,setTimeout(d,Math.floor(0)),t[s].onComplete&&("nodata"===a?r.push(function(){return t[s].onComplete(null,!1,t[s].currentInputSnapshot)}):r.push(function(){return t[s].onComplete(new Error(a),!1,null)})))}(s);for(Rr(e,e.transactionQueueTree_),s=0;s<r.length;s++)Eo(r[s]);kr(e,e.transactionQueueTree_)}}(e,xr(e,n),t),t}function Nr(e,t){for(var n=e.transactionQueueTree_,r=_e(t);null!==r&&void 0===$n(n);)n=Gn(n,r),r=_e(t=ve(t));return n}function xr(e,t){var n=[];return function e(t,n,r){var i=$n(n);if(i)for(var o=0;o<i.length;o++)r.push(i[o]);Zn(n,function(n){e(t,n,r)})}(e,t,n),n.sort(function(e,t){return e.order-t.order}),n}function Rr(e,t){var n=$n(t);if(n){for(var r=0,i=0;i<n.length;i++)2!==n[i].status&&(n[r]=n[i],r++);n.length=r,Jn(t,0<n.length?n:void 0)}Zn(t,function(t){Rr(e,t)})}function Or(e,t){var n=er(Nr(e,t));t=Gn(e.transactionQueueTree_,t);return function(e,t,n){for(var r=n?e:e.parent;null!==r;){if(t(r))return;r=r.parent}}(t,function(t){Dr(e,t)}),Dr(e,t),function e(t,n,r,i){r&&!i&&n(t),Zn(t,function(t){e(t,n,!0,i)}),r&&i&&n(t)}(t,function(t){Dr(e,t)}),n}function Dr(e,t){var n=$n(t);if(n){for(var r=[],i=[],o=-1,s=0;s<n.length;s++)3===n[s].status||(1===n[s].status?(Li(o===s-1,"All SENT items should be at beginning of queue."),n[o=s].status=3,n[s].abortReason="set"):(Li(0===n[s].status,"Unexpected transaction status in abort"),n[s].unwatcher(),i=i.concat(Rn(e.serverSyncTree_,n[s].currentWriteId,!0)),n[s].onComplete&&r.push(n[s].onComplete.bind(null,new Error("set"),!1,null))));for(-1===o?Jn(t,void 0):n.length=o+1,lr(e.eventQueue_,er(t),i),s=0;s<r.length;s++)Eo(r[s])}}function Ar(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}function Lr(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}function Mr(e,t){this.snapshotCallback=e,this.cancelCallback=t}function Fr(e,t){this._repo=e,this._path=t}function qr(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}function Wr(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function jr(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===as){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==yo)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==vo)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===Cs){if(null!=t&&!qa(t)||null!=n&&!qa(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Li(e.getIndex()instanceof Ms||e.getIndex()===Fs,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Ur(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}function Br(e,t){return Js.call(this,e,t,new Vs,!1)||this}function Vr(e,t,n){this._node=e,this.ref=t,this._index=n}function zr(e,t){return(e=O(e))._checkNotDeleted("ref"),void 0!==t?Qr(e._root,t):e._root}function Hr(e,t){(e=O(e))._checkNotDeleted("refFromURL");var n=Ga(t,e._repo.repoInfo_.nodeAdmin);return za("refFromURL",n),t=n.repoInfo,e._repo.repoInfo_.isCustomHost()||t.host===e._repo.repoInfo_.host||fo("refFromURL: Host name does not match the current database: (found "+t.host+" but expected "+e._repo.repoInfo_.host+")"),zr(e,n.path.toString())}function Qr(e,t){return(null===_e((e=O(e))._path)?Ba:Ua)("child","path",t,!1),new nu(e._repo,Ce(e._path,t))}function Yr(e,t){e=O(e),Va("set",e._path),Wa("set",t,e._path,!1);var n=new Wi;return mr(e._repo,e._path,t,null,n.wrapCallback(function(){})),n.promise}function Kr(e,t){ir("update",t,e._path,!1);var n=new Wi;return function(e,t,n,r){Er(e,"update",{path:t.toString(),value:n});var i,o,s=!0,a=fr(e),u={};K(n,function(n,r){s=!1,u[n]=Oa(Ce(t,n),Ye(r),e.serverSyncTree_,a)}),s?(co("update() called with empty data.  Don't do anything."),Ir(0,r,"ok",void 0)):(i=gr(e),o=xn(e.serverSyncTree_,t,u,i),ar(e.eventQueue_,o),e.server_.merge(t.toString(),n,function(n,o){var s="ok"===n;s||_o("update at "+t+" failed: "+n);var a=Rn(e.serverSyncTree_,i,!s);s=0<a.length?Pr(e,t):t;lr(e.eventQueue_,s,a),Ir(0,r,n,o)}),K(n,function(n){n=Or(e,Ce(t,n)),Pr(e,n)}),lr(e.eventQueue_,t,[]))}(e._repo,e._path,t,n.wrapCallback(function(){})),n.promise}function Gr(e){return e=O(e),t=e._repo,n=e,(null!=(r=Mn(t.serverSyncTree_,n))?Promise.resolve(r):t.server_.get(n).then(function(e){var r=Ye(e).withIndex(n._queryParams.getIndex());e=On(t.serverSyncTree_,n._path,r);return ur(t.eventQueue_,n._path,e),Promise.resolve(r)},function(e){return Er(t,"get for query "+m(n)+" failed: "+e),Promise.reject(new Error(e))})).then(function(t){return new ru(t,new nu(e._repo,e._path),e._queryParams.getIndex())});var t,n,r}function $r(e){this.callbackContext=e}function Jr(e,t){this.eventType=e,this.callbackContext=t}function Xr(e,t,n,r,i){var o;"object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce&&((i=function(t,n){br(e._repo,e,a),o(t,n)}).userCallback=(o=n).userCallback,i.context=n.context,n=i);n=new Za(n,s||void 0);var s,a="value"===t?new iu(n):new ou(t,n);return s=e._repo,t=a,t=".info"===_e((n=e)._path)?An(s.infoSyncTree_,n,t):An(s.serverSyncTree_,n,t),ur(s.eventQueue_,n._path,t),function(){return br(e._repo,e,a)}}function Zr(e,t,n,r){return Xr(e,"value",t,n,r)}function ei(e,t,n,r){return Xr(e,"child_added",t,n,r)}function ti(e,t,n,r){return Xr(e,"child_changed",t,n,r)}function ni(e,t,n,r){return Xr(e,"child_moved",t,n,r)}function ri(e,t,n,r){return Xr(e,"child_removed",t,n,r)}function ii(e,t,n){var r=null;n=n?new Za(n):null;"value"===t?r=new iu(n):t&&(r=new ou(t,n)),br(e._repo,e,r)}function oi(e,t){var n=Xs.call(this)||this;return n._value=e,n._key=t,n}function si(e,t){var n=Zs.call(this)||this;return n._value=e,n._key=t,n}function ai(e,t){var n=ea.call(this)||this;return n._value=e,n._key=t,n}function ui(e,t){var n=ta.call(this)||this;return n._value=e,n._key=t,n}function li(e){var t=na.call(this)||this;return t._limit=e,t}function hi(e){var t=ra.call(this)||this;return t._limit=e,t}function ci(e){var t=ia.call(this)||this;return t._path=e,t}function pi(){return null!==oa&&oa.apply(this,arguments)||this}function di(){return null!==sa&&sa.apply(this,arguments)||this}function fi(){return null!==aa&&aa.apply(this,arguments)||this}function _i(e,t){var n=ua.call(this)||this;return n._value=e,n._key=t,n}function yi(e){for(var t,n,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var s=O(e);try{for(var a=o(r),u=a.next();!u.done;u=a.next())s=u.value._apply(s)}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return s}function vi(e,t,n,r,i){var o=r||e.options.databaseURL;void 0===o&&(e.options.projectId||fo("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),co("Using default host for project ",e.options.projectId),o=e.options.projectId+"-default-rtdb.firebaseio.com");var s,a=Ga(o,i),u=a.repoInfo;r=void 0;return(r="undefined"!=typeof process?process.env[gu]:r)?(s=!0,o="http://"+r+"?ns="+u.namespace,u=(a=Ga(o,i)).repoInfo):s=!a.repoInfo.secure,t=i&&s?new ko(ko.OWNER):new So(e.name,e.options,t),za("Invalid Firebase Database URL",a),be(a.path)||fo("Database URL must point to the root of a Firebase Database (not including a child path)."),n=function(e,t,n,r){var i=mu[t.name];return i||(i={},mu[t.name]=i),(t=i[e.toURLString()])&&fo("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),t=new Ka(e,wu,n,r),i[e.toURLString()]=t}(u,e,t,new Io(e.name,n)),new Cu(n,e)}function gi(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}function mi(e,t,n,r){void 0===r&&(r={}),(e=O(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&fo("Cannot call useEmulator() after instance has already been initialized.");var i=e._repoInternal,o=void 0;i.repoInfo_.nodeAdmin?(r.mockUserToken&&fo('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),
o=new ko(ko.OWNER)):r.mockUserToken&&(e="string"==typeof r.mockUserToken?r.mockUserToken:function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0;if(!(t=e.sub||e.user_id))throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return e=Di({iss:"https://securetoken.google.com/"+n,aud:n,iat:r,exp:r+3600,auth_time:r,sub:t,user_id:t,firebase:{sign_in_provider:"custom",identities:{}}},e),[qi(JSON.stringify({alg:"none",type:"JWT"})),qi(JSON.stringify(e)),""].join(".")}(r.mockUserToken,e.app.options.projectId),o=new ko(e)),o=o,(i=i).repoInfo_=new Ro(t+":"+n,!1,i.repoInfo_.namespace,i.repoInfo_.webSocketOnly,i.repoInfo_.nodeAdmin,i.repoInfo_.persistenceKey,i.repoInfo_.includeNamespaceInQueryParams),o&&(i.authTokenProvider_=o)}function wi(e){(e=O(e))._checkNotDeleted("goOnline"),(e=e._repo).persistentConnection_&&e.persistentConnection_.resume(Qa)}function Ci(e,t){this.committed=e,this.snapshot=t}function bi(e,t,n){if(e=O(e),Va("Reference.transaction",e._path),".length"===e.key||".keys"===e.key)throw"Reference.transaction failed: "+e.key+" is a read-only object.";n=null===(i=null==n?void 0:n.applyLocally)||void 0===i||i;var r=new Wi,i=Zr(e,function(){});return function(e,t,n,r,i,o){Er(e,"transaction on "+t);var s={path:t,update:n,onComplete:r,status:null,order:ao(),applyLocally:o,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null};n=Sr(e,t,void 0);s.currentInputSnapshot=n,void 0===(r=s.update(n.val()))?(s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete&&s.onComplete(null,!1,s.currentInputSnapshot)):(ja("transaction failed: Data returned ",r,s.path),s.status=0,(i=$n(o=Gn(e.transactionQueueTree_,t))||[]).push(s),Jn(o,i),o=void 0,"object"==typeof r&&null!==r&&C(r,".priority")?(o=b(r,".priority"),Li(qa(o),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):o=(Ln(e.serverSyncTree_,t)||ks.EMPTY_NODE).getPriority().val(),i=fr(e),o=Ye(r,o),i=Da(o,n,i),s.currentOutputSnapshotRaw=o,s.currentOutputSnapshotResolved=i,s.currentWriteId=gr(e),s=Nn(e.serverSyncTree_,t,i,s.currentWriteId,s.applyLocally),lr(e.eventQueue_,t,s),kr(e,e.transactionQueueTree_))}(e._repo,e._path,t,function(t,n,i){var o;t?r.reject(t):(o=new ru(i,new nu(e._repo,e._path),Cs),r.resolve(new Tu(n,o)))},i,n),r.promise}function Ti(e){this._delegate=e}function Ei(e,t){this.committed=e,this.snapshot=t}function Ii(e,t){this._database=e,this._delegate=t}function Si(e,t){this.database=e,this._delegate=t}function ki(e,t){var n=vu.call(this,e,new tu(t._repo,t._path,new Vs,!1))||this;return n.database=e,n._delegate=t,n}function Pi(e,t){var n=this;this._delegate=e,this.app=t,this.INTERNAL={delete:function(){return n._delegate._delete()}}}var Ni,xi,Ri=t(e),Oi=function(e,t){return(Oi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},Di=function(){return(Di=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ai={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},Li=function(e,t){if(!e)throw Mi(t)},Mi=function(e){return new Error("Firebase Database ("+Ai.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},Fi={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var o=e[i],s=i+1<e.length,a=s?e[i+1]:0,u=i+2<e.length,l=u?e[i+2]:0,h=(15&a)<<2|l>>6;l=63&l;u||(l=64,s||(h=64)),r.push(n[o>>2],n[(3&o)<<4|a>>4],n[h],n[l])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(u(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i,o,s,a=e[n++];a<128?t[r++]=String.fromCharCode(a):191<a&&a<224?(o=e[n++],t[r++]=String.fromCharCode((31&a)<<6|63&o)):239<a&&a<365?(i=((7&a)<<18|(63&(o=e[n++]))<<12|(63&(s=e[n++]))<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))):(o=e[n++],s=e[n++],t[r++]=String.fromCharCode((15&a)<<12|(63&o)<<6|63&s))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var o=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0,a=++i<e.length?n[e.charAt(i)]:64,u=++i<e.length?n[e.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==u)throw Error();r.push(o<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==u&&r.push(a<<6&192|u))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},qi=function(e){return l(e).replace(/\./g,"")},Wi=(d.prototype.wrapCallback=function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"==typeof e&&(t.promise.catch(function(){}),1===e.length?e(n):e(n,r))}},d),ji="FirebaseError",Ui=(n(y,Ni=Error),y),Bi=(v.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r,i=t[0]||{},o=this.service+"/"+e;e=this.errors[e],e=e?(r=i,e.replace(Vi,function(e,t){var n=r[t];return null!=n?String(n):"<"+t+"?>"})):"Error",e=this.serviceName+": "+e+" ("+o+").";return new Ui(o,e,i)},v),Vi=/\{\$([^}]+)}/g,zi=(S.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},S.prototype.compress_=function(e,t){t=t||0;var n=this.W_;if("string"==typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,s=this.chain_[0],a=this.chain_[1],u=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(r=0;r<80;r++){var c=r<40?r<20?(o=l^a&(u^l),1518500249):(o=a^u^l,1859775393):r<60?(o=a&u|l&(a|u),2400959708):(o=a^u^l,3395469782);i=(s<<5|s>>>27)+o+h+c+n[r]&4294967295,h=l,l=u,u=4294967295&(a<<30|a>>>2),a=s,s=i}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+a&4294967295,this.chain_[2]=this.chain_[2]+u&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295},S.prototype.update=function(e,t){if(null!=e){for(var n=(t=void 0===t?e.length:t)-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<t;){if(0===o)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[o]=e.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}},S.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)e[r]=this.chain_[n]>>i&255,++r;return e},S),Hi=(D.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},D.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},D.prototype.setServiceProps=function(e){return this.serviceProps=e,this},D.prototype.setInstanceCreatedCallback=function(e){return this.onInstanceCreated=e,this},D),Qi="[DEFAULT]",Yi=(A.prototype.get=function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)&&(e=new Wi,this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize()))try{var n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}return this.instancesDeferred.get(t).promise},A.prototype.getImmediate=function(e){var t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier);e=null!==(e=null==e?void 0:e.optional)&&void 0!==e&&e;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(e)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(t){if(e)return null;throw t}},A.prototype.getComponent=function(){return this.component},A.prototype.setComponent=function(e){var t,n;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:Qi})}catch(e){}try{for(var r=o(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var a=s(i.value,2),u=a[0],l=a[1],h=this.normalizeInstanceIdentifier(u);try{var c=this.getOrInitializeService({instanceIdentifier:h});l.resolve(c)}catch(e){}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}},A.prototype.clearInstance=function(e){this.instancesDeferred.delete(e=void 0===e?Qi:e),this.instancesOptions.delete(e),this.instances.delete(e)},A.prototype.delete=function(){return r(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return e=Array.from(this.instances.values()),[4,Promise.all(a(a([],s(e.filter(function(e){return"INTERNAL"in e}).map(function(e){return e.INTERNAL.delete()}))),s(e.filter(function(e){return"_delete"in e}).map(function(e){return e._delete()}))))];case 1:return t.sent(),[2]}})})},A.prototype.isComponentSet=function(){return null!=this.component},A.prototype.isInitialized=function(e){return this.instances.has(e=void 0===e?Qi:e)},A.prototype.getOptions=function(e){return this.instancesOptions.get(e=void 0===e?Qi:e)||{}},A.prototype.initialize=function(e){var t,n,r=(e=void 0===e?{}:e).options,i=(r=void 0===r?{}:r,this.normalizeInstanceIdentifier(e.instanceIdentifier));if(this.isInitialized(i))throw Error(this.name+"("+i+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var a=this.getOrInitializeService({instanceIdentifier:i,options:r});try{for(var u=o(this.instancesDeferred.entries()),l=u.next();!l.done;l=u.next()){var h=s(l.value,2),c=h[0],p=h[1];i===this.normalizeInstanceIdentifier(c)&&p.resolve(a)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}return a},A.prototype.onInit=function(e,t){var n=this.normalizeInstanceIdentifier(t),r=null!==(t=this.onInitCallbacks.get(n))&&void 0!==t?t:new Set;return r.add(e),this.onInitCallbacks.set(n,r),t=this.instances.get(n),t&&e(t,n),function(){r.delete(e)}},A.prototype.invokeOnInitCallbacks=function(e,t){var n,r,i=this.onInitCallbacks.get(t);if(i)try{for(var s=o(i),a=s.next();!a.done;a=s.next()){var u=a.value;try{u(e,t)}catch(e){}}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},A.prototype.getOrInitializeService=function(e){var t=e.instanceIdentifier,n=e.options,r=void 0===n?{}:n;e=this.instances.get(t);if(!e&&this.component&&(e=this.component.instanceFactory(this.container,{instanceIdentifier:(n=t)===Qi?void 0:n,options:r}),this.instances.set(t,e),this.instancesOptions.set(t,r),this.invokeOnInitCallbacks(e,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,e)}catch(e){}return e||null},A.prototype.normalizeInstanceIdentifier=function(e){return void 0===e&&(e=Qi),!this.component||this.component.multipleInstances?e:Qi},A.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},A),Ki=(L.prototype.addComponent=function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component "+e.name+" has already been registered with "+this.name);t.setComponent(e)},L.prototype.addOrOverwriteComponent=function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)},L.prototype.getProvider=function(e){if(this.providers.has(e))return this.providers.get(e);var t=new Yi(e,this);return this.providers.set(e,t),t},L.prototype.getProviders=function(){return Array.from(this.providers.values())},L);(Go=xi=xi||{})[Go.DEBUG=0]="DEBUG",Go[Go.VERBOSE=1]="VERBOSE",Go[Go.INFO=2]="INFO",Go[Go.WARN=3]="WARN",Go[Go.ERROR=4]="ERROR",Go[Go.SILENT=5]="SILENT";var Gi,$i={debug:xi.DEBUG,verbose:xi.VERBOSE,info:xi.INFO,warn:xi.WARN,error:xi.ERROR,silent:xi.SILENT},Ji=xi.INFO,Xi=(($o={})[xi.DEBUG]="log",$o[xi.VERBOSE]="log",$o[xi.INFO]="info",$o[xi.WARN]="warn",$o[xi.ERROR]="error",$o),Zi=(Object.defineProperty(F.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in xi))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),F.prototype.setLogLevel=function(e){this._logLevel="string"==typeof e?$i[e]:e},Object.defineProperty(F.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),F.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,a([this,xi.DEBUG],e)),this._logHandler.apply(this,a([this,xi.DEBUG],e))},F.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,a([this,xi.VERBOSE],e)),this._logHandler.apply(this,a([this,xi.VERBOSE],e))},F.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,a([this,xi.INFO],e)),this._logHandler.apply(this,a([this,xi.INFO],e))},F.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,a([this,xi.WARN],e)),this._logHandler.apply(this,a([this,xi.WARN],e))},F.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,a([this,xi.ERROR],e)),this._logHandler.apply(this,a([this,xi.ERROR],e))},F),eo="",to=(W.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),m(t))},W.prototype.get=function(e){return e=this.domStorage_.getItem(this.prefixedName_(e)),null==e?null:g(e)},W.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},W.prototype.prefixedName_=function(e){return this.prefix_+e},W.prototype.toString=function(){return this.domStorage_.toString()},W),no=(j.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},j.prototype.get=function(e){return C(this.cache_,e)?this.cache_[e]:null},j.prototype.remove=function(e){delete this.cache_[e]},j),ro=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new to(t)}}catch(e){}return new no},io=ro("localStorage"),oo=ro("sessionStorage"),so=new Zi("@firebase/database"),ao=(Gi=1,function(){return Gi++}),uo=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",r=0;r<e.length;r++){var i=e[r];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?n+=uo.apply(null,i):n+="object"==typeof i?m(i):i,n+=" "}return n},lo=null,ho=!0,co=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];!0===ho&&(ho=!1,null===lo&&!0===oo.get("logging_enabled")&&B(!0)),lo&&(e=uo.apply(null,t),lo(e))},po=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];co.apply(void 0,a([e],s(t)))}},fo=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE FATAL ERROR: "+uo.apply(void 0,a([],s(e)));throw so.error(n),new Error(n)},_o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE WARNING: "+uo.apply(void 0,a([],s(e)));so.warn(n)},yo="[MIN_NAME]",vo="[MAX_NAME]",go=function(e,t){if(e===t)return 0;if(e===yo||t===vo)return-1;if(t===yo||e===vo)return 1;var n=To(e),r=To(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null===r&&e<t?-1:1},mo=function(e){if("object"!=typeof e||null===e)return m(e);var t,n=[];for(t in e)n.push(t);n.sort();for(var r="{",i=0;i<n.length;i++)0!==i&&(r+=","),r+=m(n[i]),r+=":",r+=mo(e[n[i]]);return r+"}"},wo=new RegExp("^-?(0*)\\d{1,10}$"),Co=-2147483648,bo=2147483647,To=function(e){return wo.test(e)&&(e=Number(e),Co<=e&&e<=bo)?e:null},Eo=function(e){try{e()}catch(e){setTimeout(function(){var t=e.stack||"";throw _o("Exception was thrown by user callback.",t),e},Math.floor(0))}},Io=(J.prototype.getToken=function(e){var t=this;return this.appCheck?this.appCheck.getToken(e):new Promise(function(n,r){setTimeout(function(){t.appCheck?t.getToken(e).then(n,r):n(null)},0)})},J.prototype.addTokenChangeListener=function(e){var t;null!==(t=this.appCheckProvider)&&void 0!==t&&t.get().then(function(t){return t.addTokenListener(e)})},J.prototype.notifyForInvalidToken=function(){_o('Provided AppCheck credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly.')},J),So=(X.prototype.getToken=function(e){var t=this;return this.auth_?this.auth_.getToken(e).catch(function(e){return e&&"auth/token-not-initialized"===e.code?(co("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)}):new Promise(function(n,r){setTimeout(function(){t.auth_?t.getToken(e).then(n,r):n(null)},0)})},X.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(function(t){return t.addAuthTokenListener(e)})},X.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then(function(t){return t.removeAuthTokenListener(e)})},X.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',_o(e)},X),ko=(Z.prototype.getToken=function(e){return Promise.resolve({accessToken:this.accessToken})},Z.prototype.addTokenChangeListener=function(e){e(this.accessToken)},Z.prototype.removeTokenChangeListener=function(e){},Z.prototype.notifyForInvalidToken=function(){},Z.OWNER="owner",Z),Po=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,No="websocket",xo="long_polling",Ro=(ee.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},ee.prototype.isCustomHost=function(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain},Object.defineProperty(ee.prototype,"host",{get:function(){return this._host},set:function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&io.set("host:"+this._host,this.internalHost))},enumerable:!1,configurable:!0}),ee.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},ee.prototype.toURLString=function(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns="+this.namespace:"";return e+this.host+"/"+t},ee),Oo=(ne.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),C(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},ne.prototype.get=function(){return c(this.counters_)},ne),Do={},Ao={},Lo=(ie.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},ie.prototype.handleResponse=function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=0;t<e.length;++t)!function(t){e[t]&&Eo(function(){n.onMessage_(e[t])})}(t);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==r(););},ie),Mo="pLPCommand",Fo="pRTLPCB",qo=(oe.prototype.open=function(e,t){var n,r,i,o=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Lo(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){o.log_("Timed out trying to connect."),o.onClosed_(),o.connectTimeoutTimer_=null},Math.floor(3e4)),n=function(){var e;o.isClosed_||(o.scriptTagHolder=new Wo(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=s(e,5),r=n[0],i=n[1],a=n[2];if(n[3],n[4],o.incrementIncomingBytes_(e),o.scriptTagHolder)if(o.connectTimeoutTimer_&&(clearTimeout(o.connectTimeoutTimer_),o.connectTimeoutTimer_=null),o.everConnected_=!0,"start"===r)o.id=i,o.password=a;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);i?(o.scriptTagHolder.sendNewPolls=!1,o.myPacketOrderer.closeAfter(i,function(){o.onClosed_()})):o.onClosed_()}},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=s(e,2),r=n[0];n=n[1];o.incrementIncomingBytes_(e),o.myPacketOrderer.handleResponse(r,n)},function(){o.onClosed_()},o.urlFn),(e={start:"t"}).ser=Math.floor(1e8*Math.random()),o.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=o.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",o.transportSessionId&&(e.s=o.transportSessionId),o.lastSessionId&&(e.ls=o.lastSessionId),o.applicationId&&(e.p=o.applicationId),o.appCheckToken&&(e.ac=o.appCheckToken),"undefined"!=typeof location&&location.hostname&&Po.test(location.hostname)&&(e.r="f"),e=o.urlFn(e),o.log_("Connecting via long-poll to "+e),o.scriptTagHolder.addTag(e,function(){}))},"complete"===document.readyState?n():(r=!1,i=function(){document.body?r||(r=!0,n()):setTimeout(i,Math.floor(10))},document.addEventListener?(document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&i()}),window.attachEvent("onload",i)))},oe.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},oe.forceAllow=function(){oe.forceAllow_=!0},oe.forceDisallow=function(){oe.forceDisallow_=!0},oe.isAvailable=function(){return!!oe.forceAllow_||!(oe.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)},oe.prototype.markConnectionHealthy=function(){},oe.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},oe.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},oe.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},oe.prototype.send=function(e){e=m(e),this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);e=l(e);for(var t=Y(e,1840),n=0;n<t.length;n++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,t.length,t[n]),this.curSegmentNum++},oe.prototype.addDisconnectPingFrame=function(e,t){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},oe.prototype.incrementIncomingBytes_=function(e){e=m(e).length,this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},oe),Wo=(se.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||co("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},se.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)},Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},se.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},se.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;e=this.urlFn(e);for(var t="",n=0;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+t.length<=1870;){var r=this.pendingSegs.shift();t=t+"&seg"+n+"="+r.seg+"&ts"+n+"="+r.ts+"&d"+n+"="+r.d;n++}return this.addLongPollTag_(e+=t,this.currentSerial),!0}return!1},se.prototype.enqueueSegment=function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()},se.prototype.addLongPollTag_=function(e,t){function n(){r.outstandingRequests.delete(t),r.newRequest_()}var r=this;this.outstandingRequests.add(t);var i=setTimeout(n,Math.floor(25e3));this.addTag(e,function(){clearTimeout(i),n()})},se.prototype.addTag=function(e,t){var n=this;setTimeout(function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){co("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(e){}},Math.floor(1))},se),jo=null;"undefined"!=typeof MozWebSocket?jo=MozWebSocket:"undefined"!=typeof WebSocket&&(jo=WebSocket);var Uo,Bo,Vo,zo,Ho,Qo=(ae.connectionURL_=function(e,t,n,r){var i={v:"5"};return"undefined"!=typeof location&&location.hostname&&Po.test(location.hostname)&&(i.r="f"),t&&(i.s=t),n&&(i.ls=n),r&&(i.ac=r),te(e,No,i)},ae.prototype.open=function(e,t){var n=this;this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,io.set("previous_websocket_failure",!0);try{_()||(r={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}},this.mySock=new jo(this.connURL,[],r))}catch(e){this.log_("Error instantiating WebSocket.");var r=e.message||e.data;return r&&this.log_(r),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(e){n.handleIncomingFrame(e)},this.mySock.onerror=function(e){n.log_("WebSocket error.  Closing connection."),e=e.message||e.data,e&&n.log_(e),n.onClosed_()}},ae.prototype.start=function(){},ae.forceDisallow=function(){ae.forceDisallow_=!0},ae.isAvailable=function(){var e,t=!1;return"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/))&&1<e.length&&parseFloat(e[1])<4.4&&(t=!0),!t&&null!==jo&&!ae.forceDisallow_},ae.previouslyFailed=function(){return io.isInMemoryStorage||!0===io.get("previous_websocket_failure")},ae.prototype.markConnectionHealthy=function(){io.remove("previous_websocket_failure")},ae.prototype.appendFrame_=function(e){this.frames.push(e),this.frames.length===this.totalFrames&&(e=this.frames.join(""),this.frames=null,e=g(e),this.onMessage(e))},ae.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},ae.prototype.extractFrameCount_=function(e){if(Li(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},ae.prototype.handleIncomingFrame=function(e){null!==this.mySock&&(e=e.data,this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames?this.appendFrame_(e):null!==(e=this.extractFrameCount_(e))&&this.appendFrame_(e))},ae.prototype.send=function(e){this.resetKeepAlive(),e=m(e),this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var t=Y(e,16384);1<t.length&&this.sendString_(String(t.length));for(var n=0;n<t.length;n++)this.sendString_(t[n])},ae.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},ae.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},ae.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},ae.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()},Math.floor(45e3))},ae.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},ae.responsesRequiredToBeHealthy=2,ae.healthyTimeout=3e4,ae),Yo=(Object.defineProperty(ue,"ALL_TRANSPORTS",{get:function(){return[qo,Qo]},enumerable:!1,configurable:!0}),
ue.prototype.initTransports_=function(e){var t,n,r=Qo&&Qo.isAvailable(),i=r&&!Qo.previouslyFailed();if(e.webSocketOnly&&(r||_o("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Qo];else{var s=this.transports_=[];try{for(var a=o(ue.ALL_TRANSPORTS),u=a.next();!u.done;u=a.next()){var l=u.value;l&&l.isAvailable()&&s.push(l)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}}},ue.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},ue.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},ue),Ko=(le.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){e.conn_&&e.conn_.open(n,r)},Math.floor(0)),t=t.healthyTimeout||0,0<t&&(this.healthyTimeout_=$(function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&102400<e.conn_.bytesReceived?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&10240<e.conn_.bytesSent?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))},Math.floor(t)))},le.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},le.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},le.prototype.connReceiver_=function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},le.prototype.sendRequest=function(e){this.sendData_({t:"d",d:e})},le.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},le.prototype.onSecondaryControl_=function(e){"t"in e&&("a"===(e=e.t)?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_()))},le.prototype.onSecondaryMessageReceived_=function(e){var t=Q("t",e);e=Q("d",e);if("c"===t)this.onSecondaryControl_(e);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(e)}},le.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},le.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},le.prototype.onPrimaryMessageReceived_=function(e){var t=Q("t",e);e=Q("d",e);"c"===t?this.onControl_(e):"d"===t&&this.onDataMessage_(e)},le.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},le.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},le.prototype.onControl_=function(e){var t=Q("t",e);if("d"in e)if(e=e.d,"h"===t)this.onHandshake_(e);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var n=0;n<this.pendingDataMessages.length;++n)this.onDataMessage_(this.pendingDataMessages[n]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(e):"r"===t?this.onReset_(e):"e"===t?V("Server Error: "+e):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):V("Unknown control packet command: "+t)},le.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&_o("Protocol version mismatch detected"),this.tryStartUpgrade_())},le.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},le.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_);e=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,e),$(function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())},Math.floor(6e4))},le.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())},le.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):$(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},le.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},le.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},le.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(io.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},le.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},le.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},le.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},le.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},le),Go=(he.prototype.put=function(e,t,n,r){},he.prototype.merge=function(e,t,n,r){},he.prototype.refreshAuthToken=function(e){},he.prototype.refreshAppCheckToken=function(e){},he.prototype.onDisconnectPut=function(e,t,n){},he.prototype.onDisconnectMerge=function(e,t,n){},he.prototype.onDisconnectCancel=function(e,t){},he.prototype.reportStats=function(e){},he),$o=(ce.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Array.isArray(this.listeners_[e]))for(var r=a([],s(this.listeners_[e])),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)},ce.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n}),e=this.getInitialEvent(e),e&&t.apply(n,e)},ce.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)},ce.prototype.validateEventType_=function(e){Li(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},ce),Jo=(n(pe,Uo=$o),pe.getInstance=function(){return new pe},pe.prototype.getInitialEvent=function(e){return Li("online"===e,"Unknown event type: "+e),[this.online_]},pe.prototype.currentlyOnline=function(){return this.online_},pe),Xo=32,Zo=768,es=(de.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},de),ts=function(e,t){this.errorPrefix_=t,this.parts_=me(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=R(this.parts_[n]);ke(this)},ns=(n(Ne,Bo=$o),Ne.getInstance=function(){return new Ne},Ne.prototype.getInitialEvent=function(e){return Li("visible"===e,"Unknown event type: "+e),[this.visible_]},Ne),rs=1e3,is=3e5,os=(n(xe,Vo=Go),xe.prototype.sendRequest=function(e,t,n){var r=++this.requestNumber_;t={r:r,a:e,b:t};this.log_(m(t)),Li(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(t),n&&(this.requestCBHash_[r]=n)},xe.prototype.get=function(e){var t=this;this.initConnection_();var n=new Wi,r={p:e._path.toString(),q:e._queryObject},i={action:"g",request:r,onComplete:function(e){var i=e.d;"ok"===e.s?(t.onDataUpdate_(r.p,i,!1,null),n.resolve(i)):n.reject(i)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;var o=this.outstandingGets_.length-1;return this.connected_||setTimeout(function(){var e=t.outstandingGets_[o];void 0!==e&&i===e&&(delete t.outstandingGets_[o],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),t.log_("get "+o+" timed out on connection"),n.reject(new Error("Client is offline.")))},3e3),this.connected_&&this.sendGet_(o),n.promise},xe.prototype.listen=function(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),Li(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Li(!this.listens.get(o).has(i),"listen() called twice for same path/queryId."),n={onComplete:r,hashFn:t,query:e,tag:n},this.listens.get(o).set(i,n),this.connected_&&this.sendListen_(n)},xe.prototype.sendGet_=function(e){var t=this,n=this.outstandingGets_[e];this.sendRequest("g",n.request,function(r){delete t.outstandingGets_[e],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})},xe.prototype.sendListen_=function(e){var t=this,n=e.query,r=n._path.toString(),i=n._queryIdentifier;this.log_("Listen on "+r+" for "+i);var o={p:r};e.tag&&(o.q=n._queryObject,o.t=e.tag),o.h=e.hashFn(),this.sendRequest("q",o,function(o){var s=o.d,a=o.s;xe.warnOnListenWarnings_(s,n),(t.listens.get(r)&&t.listens.get(r).get(i))===e&&(t.log_("listen response",o),"ok"!==a&&t.removeListen_(r,i),e.onComplete&&e.onComplete(a,s))})},xe.warnOnListenWarnings_=function(e,t){e&&"object"==typeof e&&C(e,"w")&&(e=b(e,"w"),Array.isArray(e)&&~e.indexOf("no_index")&&(e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',t=t._path.toString(),_o("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+e+" at "+t+" to your security rules for better performance.")))},xe.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(e)},xe.prototype.reduceReconnectDelayIfAdminCredential_=function(e){(e&&40===e.length||function(e){return e=w(e).claims,"object"==typeof e&&!0===e.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},xe.prototype.refreshAppCheckToken=function(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},function(){})},xe.prototype.tryAuth=function(){var e,t,n,r=this;this.connected_&&this.authToken_&&(t=function(e){return e=w(e).claims,!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(e=this.authToken_)?"auth":"gauth",n={cred:e},null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,function(t){var n=t.s;t=t.d||"error";r.authToken_===e&&("ok"===n?r.invalidAuthTokenCount_=0:r.onAuthRevoked_(n,t))}))},xe.prototype.tryAppCheck=function(){var e=this;this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},function(t){var n=t.s;t=t.d||"error";"ok"===n?e.invalidAppCheckTokenCount_=0:e.onAppCheckRevoked_(n,t)})},xe.prototype.unlisten=function(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),Li(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)},xe.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t),e={p:e},r&&(e.q=n,e.t=r),this.sendRequest("n",e)},xe.prototype.onDisconnectPut=function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})},xe.prototype.onDisconnectMerge=function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})},xe.prototype.onDisconnectCancel=function(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},xe.prototype.sendOnDisconnect_=function(e,t,n,r){n={p:t,d:n},this.log_("onDisconnect "+e,n),this.sendRequest(e,n,function(e){r&&setTimeout(function(){r(e.s,e.d)},Math.floor(0))})},xe.prototype.put=function(e,t,n,r){this.putInternal("p",e,t,n,r)},xe.prototype.merge=function(e,t,n,r){this.putInternal("m",e,t,n,r)},xe.prototype.putInternal=function(e,t,n,r,i){this.initConnection_(),n={p:t,d:n},void 0!==i&&(n.h=i),this.outstandingPuts_.push({action:e,request:n,onComplete:r}),this.outstandingPutCount_++,r=this.outstandingPuts_.length-1,this.connected_?this.sendPut_(r):this.log_("Buffering put: "+t)},xe.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)})},xe.prototype.reportStats=function(e){var t=this;this.connected_&&(this.log_("reportStats",e={c:e}),this.sendRequest("s",e,function(e){"ok"!==e.s&&(e=e.d,t.log_("reportStats","Error sending stats: "+e))}))},xe.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+m(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},xe.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):V("Unrecognized action received from server: "+m(e)+"\nAre you using the latest client?")},xe.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},xe.prototype.scheduleConnect_=function(e){var t=this;Li(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){t.establishConnectionTimer_=null,t.establishConnection_()},Math.floor(e))},xe.prototype.initConnection_=function(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)},xe.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=rs,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},xe.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=rs,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},xe.prototype.onRealtimeDisconnect_=function(){var e;this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()&&(this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=rs),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime()),e=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-e),e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)),this.onConnectStatus_(!1)},xe.prototype.establishConnection_=function(){return r(this,void 0,void 0,function(){var e,t,n,r,o,a,u,l,h,c,p=this;return i(this,function(i){switch(i.label){case 0:if(!this.shouldReconnect_())return[3,4];this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null,e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+xe.nextConnectionId_++,c=this.lastSessionId,o=!1,a=null,u=function(){a?a.close():(o=!0,n())},h=function(e){Li(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)},this.realtime_={close:u,sendRequest:h},l=this.forceTokenRefresh_,this.forceTokenRefresh_=!1,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)])];case 2:return h=s.apply(void 0,[i.sent(),2]),l=h[0],h=h[1],o?co("getToken() completed but was canceled"):(co("getToken() completed. Creating connection."),this.authToken_=l&&l.accessToken,this.appCheckToken_=h&&h.token,a=new Ko(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,function(e){_o(e+" ("+p.repoInfo_.toString()+")"),p.interrupt("server_kill")},c)),[3,4];case 3:return c=i.sent(),this.log_("Failed to get token: "+c),o||(this.repoInfo_.nodeAdmin&&_o(c),u()),[3,4];case 4:return[2]}})})},xe.prototype.interrupt=function(e){co("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},xe.prototype.resume=function(e){co("Resuming connection for reason: "+e),delete this.interruptReasons_[e],T(this.interruptReasons_)&&(this.reconnectDelay_=rs,this.realtime_||this.scheduleConnect_(0))},xe.prototype.handleTimestamp_=function(e){e-=(new Date).getTime(),this.onServerInfoUpdate_({serverTimeOffset:e})},xe.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},xe.prototype.onListenRevoked_=function(e,t){t=t?t.map(function(e){return mo(e)}).join("$"):"default",t=this.removeListen_(e,t),t&&t.onComplete&&t.onComplete("permission_denied")},xe.prototype.removeListen_=function(e,t){var n,r=new es(e).toString();return this.listens.has(r)?(n=(e=this.listens.get(r)).get(t),e.delete(t),0===e.size&&this.listens.delete(r)):n=void 0,n},xe.prototype.onAuthRevoked_=function(e,t){co("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},xe.prototype.onAppCheckRevoked_=function(e,t){co("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,3<=this.invalidAppCheckTokenCount_&&this.appCheckTokenProvider_.notifyForInvalidToken())},xe.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},xe.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth(),this.tryAppCheck();try{for(var i=o(this.listens.values()),s=i.next();!s.done;s=i.next()){var a=s.value;try{for(var u=(n=void 0,o(a.values())),l=u.next();!l.done;l=u.next()){var h=l.value;this.sendListen_(h)}}catch(t){n={error:t}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var c=0;c<this.outstandingPuts_.length;c++)this.outstandingPuts_[c]&&this.sendPut_(c);for(;this.onDisconnectRequestQueue_.length;){var p=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(p.action,p.pathString,p.data,p.onComplete)}for(c=0;c<this.outstandingGets_.length;c++)this.outstandingGets_[c]&&this.sendGet_(c)},xe.prototype.sendConnectStats_=function(){var e={};e["sdk.js."+eo.replace(/\./g,"-")]=1,f()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)},xe.prototype.shouldReconnect_=function(){var e=Jo.getInstance().currentlyOnline();return T(this.interruptReasons_)&&e},xe.nextPersistentConnectionId_=0,xe.nextConnectionId_=0,xe),ss=(Re.Wrap=function(e,t){return new Re(e,t)},Re),as=(ro=(Oe.prototype.getCompare=function(){return this.compare.bind(this)},Oe.prototype.indexedValueChanged=function(e,t){return e=new ss(yo,e),t=new ss(yo,t),0!==this.compare(e,t)},Oe.prototype.minPost=function(){return ss.MIN},Oe),Zi=(n(De,Ho=ro),Object.defineProperty(De,"__EMPTY_NODE",{get:function(){return zo},set:function(e){zo=e},enumerable:!1,configurable:!0}),De.prototype.compare=function(e,t){return go(e.name,t.name)},De.prototype.isDefinedOn=function(e){throw Mi("KeyIndex.isDefinedOn not expected to be called.")},De.prototype.indexedValueChanged=function(e,t){return!1},De.prototype.minPost=function(){return ss.MIN},De.prototype.maxPost=function(){return new ss(vo,zo)},De.prototype.makePost=function(e,t){return Li("string"==typeof e,"KeyIndex indexValue must always be a string."),new ss(e,zo)},De.prototype.toString=function(){return".key"},De),new Zi),us=(Ae.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_.pop(),t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value};if(this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},Ae.prototype.hasNext=function(){return 0<this.nodeStack_.length},Ae.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},Ae),ls=(Le.prototype.copy=function(e,t,n,r,i){return new Le(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Le.prototype.count=function(){return this.left.count()+1+this.right.count()},Le.prototype.isEmpty=function(){return!1},Le.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},Le.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},Le.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},Le.prototype.minKey=function(){return this.min_().key},Le.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},Le.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()},Le.prototype.removeMin_=function(){if(this.left.isEmpty())return gs.EMPTY_NODE;var e=this;return(e=(e=e.left.isRed_()||e.left.left.isRed_()?e:e.moveRedLeft_()).copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},Le.prototype.remove=function(e,t){var n,r=this;if(t(e,r.key)<0)r=(r=r.left.isEmpty()||r.left.isRed_()||r.left.left.isRed_()?r:r.moveRedLeft_()).copy(null,null,null,r.left.remove(e,t),null);else{if(0===t(e,(r=(r=r.left.isRed_()?r.rotateRight_():r).right.isEmpty()||r.right.isRed_()||r.right.left.isRed_()?r:r.moveRedRight_()).key)){if(r.right.isEmpty())return gs.EMPTY_NODE;n=r.right.min_(),r=r.copy(n.key,n.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()},Le.prototype.isRed_=function(){return this.color},Le.prototype.fixUp_=function(){var e=this;return(e=(e=e.right.isRed_()&&!e.left.isRed_()?e.rotateLeft_():e).left.isRed_()&&e.left.left.isRed_()?e.rotateRight_():e).left.isRed_()&&e.right.isRed_()?e.colorFlip_():e},Le.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()?(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_():e},Le.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()?(e=e.rotateRight_()).colorFlip_():e},Le.prototype.rotateLeft_=function(){var e=this.copy(null,null,Le.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},Le.prototype.rotateRight_=function(){var e=this.copy(null,null,Le.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},Le.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},Le.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},Le.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},Le.RED=!0,Le.BLACK=!1,Le);Me.prototype.copy=function(e,t,n,r,i){return this},Me.prototype.insert=function(e,t,n){return new ls(e,t,null)},Me.prototype.remove=function(e,t){return this},Me.prototype.count=function(){return 0},Me.prototype.isEmpty=function(){return!0},Me.prototype.inorderTraversal=function(e){return!1},Me.prototype.reverseTraversal=function(e){return!1},Me.prototype.minKey=function(){return null},Me.prototype.maxKey=function(){return null},Me.prototype.check_=function(){return 0},Me.prototype.isRed_=function(){return!1},$o=Me;var hs,cs,ps,ds,fs,_s,ys,vs,gs=(Fe.prototype.insert=function(e,t){return new Fe(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,ls.BLACK,null,null))},Fe.prototype.remove=function(e){return new Fe(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,ls.BLACK,null,null))},Fe.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:0<t&&(n=n.right)}return null},Fe.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:0<t&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},Fe.prototype.isEmpty=function(){return this.root_.isEmpty()},Fe.prototype.count=function(){return this.root_.count()},Fe.prototype.minKey=function(){return this.root_.minKey()},Fe.prototype.maxKey=function(){return this.root_.maxKey()},Fe.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},Fe.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},Fe.prototype.getIterator=function(e){return new us(this.root_,null,this.comparator_,!1,e)},Fe.prototype.getIteratorFrom=function(e,t){return new us(this.root_,e,this.comparator_,!1,t)},Fe.prototype.getReverseIteratorFrom=function(e,t){return new us(this.root_,e,this.comparator_,!0,t)},Fe.prototype.getReverseIterator=function(e){return new us(this.root_,null,this.comparator_,!0,e)},Fe.EMPTY_NODE=new $o,Fe),ms=function(e){var t;e.isLeafNode()?(t=e.val(),Li("string"==typeof t||"number"==typeof t||"object"==typeof t&&C(t,".sv"),"Priority must be a string or number.")):Li(e===hs||e.isEmpty(),"priority of unexpected type."),Li(e===hs||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},ws=(Object.defineProperty(Ue,"__childrenNodeConstructor",{get:function(){return cs},set:function(e){cs=e},enumerable:!1,configurable:!0}),Ue.prototype.isLeafNode=function(){return!0},Ue.prototype.getPriority=function(){return this.priorityNode_},Ue.prototype.updatePriority=function(e){return new Ue(this.value_,e)},Ue.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:Ue.__childrenNodeConstructor.EMPTY_NODE},Ue.prototype.getChild=function(e){return be(e)?this:".priority"===_e(e)?this.priorityNode_:Ue.__childrenNodeConstructor.EMPTY_NODE},Ue.prototype.hasChild=function(){return!1},Ue.prototype.getPredecessorChildName=function(e,t){return null},Ue.prototype.updateImmediateChild=function(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Ue.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)},Ue.prototype.updateChild=function(e,t){var n=_e(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(Li(".priority"!==n||1===ye(e),".priority must be the last token in a path"),this.updateImmediateChild(n,Ue.__childrenNodeConstructor.EMPTY_NODE.updateChild(ve(e),t)))},Ue.prototype.isEmpty=function(){return!1},Ue.prototype.numChildren=function(){return 0},Ue.prototype.forEachChild=function(e,t){return!1},Ue.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()
}:this.getValue()},Ue.prototype.hash=function(){var e,t;return null===this.lazyHash_&&(e="",this.priorityNode_.isEmpty()||(e+="priority:"+je(this.priorityNode_.val())+":"),e+=(t=typeof this.value_)+":",e+="number"==t?G(this.value_):this.value_,this.lazyHash_=U(e)),this.lazyHash_},Ue.prototype.getValue=function(){return this.value_},Ue.prototype.compareTo=function(e){return e===Ue.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Ue.__childrenNodeConstructor?-1:(Li(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},Ue.prototype.compareToLeafNode_=function(e){var t=typeof e.value_,n=typeof this.value_,r=Ue.VALUE_TYPE_ORDER.indexOf(t),i=Ue.VALUE_TYPE_ORDER.indexOf(n);return Li(0<=r,"Unknown leaf type: "+t),Li(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r},Ue.prototype.withIndex=function(){return this},Ue.prototype.isIndexed=function(){return!0},Ue.prototype.equals=function(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)},Ue.VALUE_TYPE_ORDER=["object","boolean","number","string"],Ue),Cs=new(n(Be,fs=ro),Be.prototype.compare=function(e,t){var n=e.node.getPriority(),r=t.node.getPriority();r=n.compareTo(r);return 0===r?go(e.name,t.name):r},Be.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},Be.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},Be.prototype.minPost=function(){return ss.MIN},Be.prototype.maxPost=function(){return new ss(vo,new ws("[PRIORITY-POST]",ds))},Be.prototype.makePost=function(e,t){return e=ps(e),new ss(t,new ws("[PRIORITY-POST]",e))},Be.prototype.toString=function(){return".priority"},Be),bs=Math.log(2),Ts=(Ve.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},Ve),Es=function(e,t,n,r){e.sort(t);var i=function(t,r){var o=r-t;if(0==o)return null;if(1==o)return s=e[t],a=n?n(s):s,new ls(a,s.node,ls.BLACK,null,null);o=parseInt(o/2,10)+t,t=i(t,o),r=i(o+1,r);var s=e[o],a=n?n(s):s;return new ls(a,s.node,ls.BLACK,t,r)},o=function(t){for(var r=null,o=null,s=e.length,a=function(t,r){var o=s-t,a=s;s-=t,t=i(1+o,a),a=e[o],o=n?n(a):a,u(new ls(o,a.node,r,null,t))},u=function(e){r=r?r.left=e:o=e},l=0;l<t.count;++l){var h=t.nextBitIsOne(),c=Math.pow(2,t.count-(l+1));h?a(c,ls.BLACK):(a(c,ls.BLACK),a(c,ls.RED))}return o}(new Ts(e.length));return new gs(r||t,o)},Is={},Ss=(Object.defineProperty(ze,"Default",{get:function(){return Li(Cs,"ChildrenNode.ts has not been loaded"),_s=_s||new ze({".priority":Is},{".priority":Cs})},enumerable:!1,configurable:!0}),ze.prototype.get=function(e){var t=b(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof gs?t:null},ze.prototype.hasIndex=function(e){return C(this.indexSet_,e.toString())},ze.prototype.addIndex=function(e,t){Li(e!==as,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n=[],r=!1,i=t.getIterator(ss.Wrap),o=i.getNext();o;)r=r||e.isDefinedOn(o.node),n.push(o),o=i.getNext();var s=r?Es(n,e.getCompare()):Is,a=e.toString(),u=Di({},this.indexSet_);return u[a]=e,t=Di({},this.indexes_),t[a]=s,new ze(t,u)},ze.prototype.addToIndexes=function(e,t){var n=this;return new ze(E(this.indexes_,function(r,i){var o=b(n.indexSet_,i);if(Li(o,"Missing index implementation for "+i),r===Is){if(o.isDefinedOn(e.node)){for(var s=[],a=t.getIterator(ss.Wrap),u=a.getNext();u;)u.name!==e.name&&s.push(u),u=a.getNext();return s.push(e),Es(s,o.getCompare())}return Is}return i=t.get(e.name),o=r,(o=i?r.remove(new ss(e.name,i)):o).insert(e,e.node)}),this.indexSet_)},ze.prototype.removeFromIndexes=function(e,t){return new ze(E(this.indexes_,function(n){if(n===Is)return n;var r=t.get(e.name);return r?n.remove(new ss(e.name,r)):n}),this.indexSet_)},ze),ks=(Object.defineProperty(He,"EMPTY_NODE",{get:function(){return ys=ys||new He(new gs(We),null,Ss.Default)},enumerable:!1,configurable:!0}),He.prototype.isLeafNode=function(){return!1},He.prototype.getPriority=function(){return this.priorityNode_||ys},He.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new He(this.children_,e,this.indexMap_)},He.prototype.getImmediateChild=function(e){return".priority"===e?this.getPriority():(e=this.children_.get(e),null===e?ys:e)},He.prototype.getChild=function(e){var t=_e(e);return null===t?this:this.getImmediateChild(t).getChild(ve(e))},He.prototype.hasChild=function(e){return null!==this.children_.get(e)},He.prototype.updateImmediateChild=function(e,t){if(Li(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);var n=new ss(e,t),r=void 0,i=void 0;i=t.isEmpty()?(r=this.children_.remove(e),this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,t),this.indexMap_.addToIndexes(n,this.children_)),n=r.isEmpty()?ys:this.priorityNode_;return new He(r,n,i)},He.prototype.updateChild=function(e,t){var n=_e(e);return null===n?t:(Li(".priority"!==_e(e)||1===ye(e),".priority must be the last token in a path"),t=this.getImmediateChild(n).updateChild(ve(e),t),this.updateImmediateChild(n,t))},He.prototype.isEmpty=function(){return this.children_.isEmpty()},He.prototype.numChildren=function(){return this.children_.count()},He.prototype.val=function(e){if(this.isEmpty())return null;var t={},n=0,r=0,i=!0;if(this.forEachChild(Cs,function(o,s){t[o]=s.val(e),n++,i&&He.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1}),!e&&i&&r<2*n){var o,s=[];for(o in t)s[o]=t[o];return s}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t},He.prototype.hash=function(){var e;return null===this.lazyHash_&&(e="",this.getPriority().isEmpty()||(e+="priority:"+je(this.getPriority().val())+":"),this.forEachChild(Cs,function(t,n){n=n.hash(),""!==n&&(e+=":"+t+":"+n)}),this.lazyHash_=""===e?"":U(e)),this.lazyHash_},He.prototype.getPredecessorChildName=function(e,t,n){return n=this.resolveIndex_(n),n?(t=n.getPredecessorKey(new ss(e,t)),t?t.name:null):this.children_.getPredecessorKey(e)},He.prototype.getFirstChildName=function(e){return e=this.resolveIndex_(e),e?(e=e.minKey(),e&&e.name):this.children_.minKey()},He.prototype.getFirstChild=function(e){return e=this.getFirstChildName(e),e?new ss(e,this.children_.get(e)):null},He.prototype.getLastChildName=function(e){return e=this.resolveIndex_(e),e?(e=e.maxKey(),e&&e.name):this.children_.maxKey()},He.prototype.getLastChild=function(e){return e=this.getLastChildName(e),e?new ss(e,this.children_.get(e)):null},He.prototype.forEachChild=function(e,t){return e=this.resolveIndex_(e),e?e.inorderTraversal(function(e){return t(e.name,e.node)}):this.children_.inorderTraversal(t)},He.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},He.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,function(e){return e});for(var r=this.children_.getIteratorFrom(e.name,ss.Wrap),i=r.peek();null!=i&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r},He.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},He.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,function(e){return e});for(var r=this.children_.getReverseIteratorFrom(e.name,ss.Wrap),i=r.peek();null!=i&&0<t.compare(i,e);)r.getNext(),i=r.peek();return r},He.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Ps?-1:0},He.prototype.withIndex=function(e){return e===as||this.indexMap_.hasIndex(e)?this:(e=this.indexMap_.addIndex(e,this.children_),new He(this.children_,this.priorityNode_,e))},He.prototype.isIndexed=function(e){return e===as||this.indexMap_.hasIndex(e)},He.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var t=this.getIterator(Cs),n=e.getIterator(Cs),r=t.getNext(),i=n.getNext();r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=t.getNext(),i=n.getNext()}return null===r&&null===i}return!1},He.prototype.resolveIndex_=function(e){return e===as?null:this.indexMap_.get(e.toString())},He.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,He),Ps=new(n(Qe,vs=ks),Qe.prototype.compareTo=function(e){return e===this?0:1},Qe.prototype.equals=function(e){return e===this},Qe.prototype.getPriority=function(){return this},Qe.prototype.getImmediateChild=function(e){return ks.EMPTY_NODE},Qe.prototype.isEmpty=function(){return!1},Qe);Object.defineProperties(ss,{MIN:{value:new ss(yo,ks.EMPTY_NODE)},MAX:{value:new ss(vo,Ps)}}),Zi.__EMPTY_NODE=ks.EMPTY_NODE,ws.__childrenNodeConstructor=ks,ds=hs=Ps;var Ns=!0;ps=Ye;var xs,Rs,Os,Ds,As,Ls,Ms=(n(Ke,xs=ro),Ke.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},Ke.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},Ke.prototype.compare=function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node);r=n.compareTo(r);return 0===r?go(e.name,t.name):r},Ke.prototype.makePost=function(e,t){return e=Ye(e),e=ks.EMPTY_NODE.updateChild(this.indexPath_,e),new ss(t,e)},Ke.prototype.maxPost=function(){var e=ks.EMPTY_NODE.updateChild(this.indexPath_,Ps);return new ss(vo,e)},Ke.prototype.toString=function(){return me(this.indexPath_,0).join("/")},Ke),Fs=new(n(Ge,Rs=ro),Ge.prototype.compare=function(e,t){var n=e.node.compareTo(t.node);return 0===n?go(e.name,t.name):n},Ge.prototype.isDefinedOn=function(e){return!0},Ge.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},Ge.prototype.minPost=function(){return ss.MIN},Ge.prototype.maxPost=function(){return ss.MAX},Ge.prototype.makePost=function(e,t){return e=Ye(e),new ss(t,e)},Ge.prototype.toString=function(){return".value"},Ge),qs="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Ws=(Os=0,Ds=[],function(e){var t=e===Os;Os=e;for(var n=new Array(8),r=7;0<=r;r--)n[r]=qs.charAt(e%64),e=Math.floor(e/64);Li(0===e,"Cannot push at time == 0");var i=n.join("");if(t){for(r=11;0<=r&&63===Ds[r];r--)Ds[r]=0;Ds[r]++}else for(r=0;r<12;r++)Ds[r]=Math.floor(64*Math.random());for(r=0;r<12;r++)i+=qs.charAt(Ds[r]);return Li(20===i.length,"nextPushId: Length should be 20."),i}),js=(nt.prototype.updateChild=function(e,t,n,r,i,o){Li(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var s=e.getImmediateChild(t);return s.getChild(r).equals(n.getChild(r))&&s.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(et(t,s)):Li(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?o.trackChildChange(Ze(t,n)):o.trackChildChange(tt(t,n,s))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))},nt.prototype.updateFullNode=function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(Cs,function(e,r){t.hasChild(e)||n.trackChildChange(et(e,r))}),t.isLeafNode()||t.forEachChild(Cs,function(t,r){var i;e.hasChild(t)?(i=e.getImmediateChild(t)).equals(r)||n.trackChildChange(tt(t,r,i)):n.trackChildChange(Ze(t,r))})),t.withIndex(this.index_)},nt.prototype.updatePriority=function(e,t){return e.isEmpty()?ks.EMPTY_NODE:e.updatePriority(t)},nt.prototype.filtersNodes=function(){return!1},nt.prototype.getIndexedFilter=function(){return this},nt.prototype.getIndex=function(){return this.index_},nt),Us=(rt.prototype.getStartPost=function(){return this.startPost_},rt.prototype.getEndPost=function(){return this.endPost_},rt.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},rt.prototype.updateChild=function(e,t,n,r,i,o){return this.matches(new ss(t,n))||(n=ks.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,o)},rt.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=ks.EMPTY_NODE);var r=(r=t.withIndex(this.index_)).updatePriority(ks.EMPTY_NODE),i=this;return t.forEachChild(Cs,function(e,t){i.matches(new ss(e,t))||(r=r.updateImmediateChild(e,ks.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)},rt.prototype.updatePriority=function(e,t){return e},rt.prototype.filtersNodes=function(){return!0},rt.prototype.getIndexedFilter=function(){return this.indexedFilter_},rt.prototype.getIndex=function(){return this.index_},rt.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},rt.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},rt),Bs=(it.prototype.updateChild=function(e,t,n,r,i,o){return this.rangedFilter_.matches(new ss(t,n))||(n=ks.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,o):this.fullLimitUpdateChild_(e,t,n,i,o)},it.prototype.updateFullNode=function(e,t,n){if(t.isLeafNode()||t.isEmpty())r=ks.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){var r=ks.EMPTY_NODE.withIndex(this.index_),i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var s=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0:this.index_.compare(s,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(s.name,s.node),o++}}else{r=(r=t.withIndex(this.index_)).updatePriority(ks.EMPTY_NODE);var a,u=void 0,l=void 0,h=void 0;i=void 0;h=this.reverse_?(i=r.getReverseIterator(this.index_),u=this.rangedFilter_.getEndPost(),l=this.rangedFilter_.getStartPost(),a=this.index_.getCompare(),function(e,t){return a(t,e)}):(i=r.getIterator(this.index_),u=this.rangedFilter_.getStartPost(),l=this.rangedFilter_.getEndPost(),this.index_.getCompare());o=0;for(var c=!1;i.hasNext();)s=i.getNext(),(c=!c&&h(u,s)<=0||c)&&o<this.limit_&&h(s,l)<=0?o++:r=r.updateImmediateChild(s.name,ks.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},it.prototype.updatePriority=function(e,t){return e},it.prototype.filtersNodes=function(){return!0},it.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},it.prototype.getIndex=function(){return this.index_},it.prototype.fullLimitUpdateChild_=function(e,t,n,r,i){var o,s;s=this.reverse_?(o=this.index_.getCompare(),function(e,t){return o(t,e)}):this.index_.getCompare();var a=e;Li(a.numChildren()===this.limit_,"");var u=new ss(t,n),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(a.hasChild(t)){for(var c=a.getImmediateChild(t),p=r.getChildAfterChild(this.index_,l,this.reverse_);null!=p&&(p.name===t||a.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);var d=null==p?1:s(p,u);return h&&!n.isEmpty()&&0<=d?(null!=i&&i.trackChildChange(tt(t,n,c)),a.updateImmediateChild(t,n)):(null!=i&&i.trackChildChange(et(t,c)),c=a.updateImmediateChild(t,ks.EMPTY_NODE),null!=p&&this.rangedFilter_.matches(p)?(null!=i&&i.trackChildChange(Ze(p.name,p.node)),c.updateImmediateChild(p.name,p.node)):c)}return!n.isEmpty()&&h&&0<=s(l,u)?(null!=i&&(i.trackChildChange(et(l.name,l.node)),i.trackChildChange(Ze(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(l.name,ks.EMPTY_NODE)):e},it),Vs=(ot.prototype.hasStart=function(){return this.startSet_},ot.prototype.hasStartAfter=function(){return this.startAfterSet_},ot.prototype.hasEndBefore=function(){return this.endBeforeSet_},ot.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_},ot.prototype.getIndexStartValue=function(){return Li(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},ot.prototype.getIndexStartName=function(){return Li(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:yo},ot.prototype.hasEnd=function(){return this.endSet_},ot.prototype.getIndexEndValue=function(){return Li(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},ot.prototype.getIndexEndName=function(){return Li(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:vo},ot.prototype.hasLimit=function(){return this.limitSet_},ot.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},ot.prototype.getLimit=function(){return Li(this.limitSet_,"Only valid if limit has been set"),this.limit_},ot.prototype.getIndex=function(){return this.index_},ot.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},ot.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===Cs},ot.prototype.copy=function(){var e=new ot;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},ot),zs=(n(ct,As=Go),ct.prototype.reportStats=function(e){throw new Error("Method not implemented.")},ct.getListenId_=function(e,t){return void 0!==t?"tag$"+t:(Li(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())},ct.prototype.listen=function(e,t,n,r){var i=this,o=e._path.toString();this.log_("Listen called for "+o+" "+e._queryIdentifier);var s=ct.getListenId_(e,n),a={};this.listens_[s]=a,e=lt(e._queryParams),this.restRequest_(o+".json",e,function(e,t){null===(e=404===e?t=null:e)&&i.onDataUpdate_(o,t,!1,n),b(i.listens_,s)===a&&r(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})},ct.prototype.unlisten=function(e,t){t=ct.getListenId_(e,t),delete this.listens_[t]},ct.prototype.get=function(e){var t=this,n=lt(e._queryParams),r=e._path.toString(),i=new Wi;return this.restRequest_(r+".json",n,function(e,n){null===(e=404===e?n=null:e)?(t.onDataUpdate_(r,n,!1,null),i.resolve(n)):i.reject(new Error(n))}),i.promise},ct.prototype.refreshAuthToken=function(e){},ct.prototype.restRequest_=function(e,t,n){var r=this;return(t=void 0===t?{}:t).format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(function(i){var o=s(i,2);i=o[0],o=o[1];i&&i.accessToken&&(t.auth=i.accessToken),o&&o.token&&(t.ac=o.token);var a=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+e+"?ns="+r.repoInfo_.namespace+I(t);r.log_("Sending REST request for "+a);var u=new XMLHttpRequest;u.onreadystatechange=function(){if(n&&4===u.readyState){r.log_("REST Response for "+a+" received. status:",u.status,"response:",u.responseText);var e=null;if(200<=u.status&&u.status<300){try{e=g(u.responseText)}catch(e){_o("Failed to parse JSON response for "+a+": "+u.responseText)}n(null,e)}else 401!==u.status&&404!==u.status&&_o("Got unsuccessful REST response for "+a+" Status: "+u.status),n(u.status);n=null}},u.open("GET",a,!0),u.send()})},ct),Hs=(pt.prototype.getNode=function(e){return this.rootNode_.getChild(e)},pt.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},pt),Qs=(yt.prototype.get=function(){var e=this.collection_.get(),t=Di({},e);return this.last_&&K(this.last_,function(e,n){t[e]=t[e]-n}),this.last_=e,t},yt),Ys=(vt.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},r=!1;K(t,function(t,i){0<i&&C(e.statsToReport_,t)&&(n[t]=i,r=!0)}),r&&this.server_.reportStats(n),$(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},vt);(Go=Ls=Ls||{})[Go.OVERWRITE=0]="OVERWRITE",Go[Go.MERGE=1]="MERGE",Go[Go.ACK_USER_WRITE=2]="ACK_USER_WRITE",Go[Go.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var Ks,Gs,$s,Js,Xs,Zs,ea,ta,na,ra,ia,oa,sa,aa,ua,la,ha,ca=(Ct.prototype.operationForChild=function(e){if(be(this.path)){if(null!=this.affectedTree.value)return Li(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new es(e));return new Ct(fe(),t,this.revert)}return Li(_e(this.path)===e,"operationForChild called for unrelated child."),new Ct(ve(this.path),this.affectedTree,this.revert)},Ct),pa=(bt.prototype.operationForChild=function(e){return be(this.path)?new bt(this.source,fe()):new bt(this.source,ve(this.path))},bt),da=(Tt.prototype.operationForChild=function(e){return be(this.path)?new Tt(this.source,fe(),this.snap.getImmediateChild(e)):new Tt(this.source,ve(this.path),this.snap)},Tt),fa=(Et.prototype.operationForChild=function(e){if(be(this.path)){var t=this.children.subtree(new es(e));return t.isEmpty()?null:t.value?new da(this.source,fe(),t.value):new Et(this.source,fe(),t)}return Li(_e(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Et(this.source,ve(this.path),this.children)},Et.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},Et),_a=(It.prototype.isFullyInitialized=function(){return this.fullyInitialized_},It.prototype.isFiltered=function(){return this.filtered_},It.prototype.isCompleteForPath=function(e){return be(e)?this.isFullyInitialized()&&!this.filtered_:(e=_e(e),this.isCompleteForChild(e))},It.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},It.prototype.getNode=function(){return this.node_},It),ya=function(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()},va=(Dt.fromObject=function(e){var t=new Dt(null);return K(e,function(e,n){t=t.set(new es(e),n)}),t},Dt.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},Dt.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:fe(),value:this.value};if(be(e))return null;var n=_e(e),r=this.children.get(n);return null===r?null:(t=r.findRootMostMatchingPathAndValue(ve(e),t),null==t?null:{path:Ce(new es(n),t.path),value:t.value})},Dt.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,function(){return!0})},Dt.prototype.subtree=function(e){if(be(e))return this;var t=_e(e);t=this.children.get(t);return null!==t?t.subtree(ve(e)):new Dt(null)},Dt.prototype.set=function(e,t){if(be(e))return new Dt(t,this.children);var n=_e(e);t=(this.children.get(n)||new Dt(null)).set(ve(e),t),t=this.children.insert(n,t);return new Dt(this.value,t)},Dt.prototype.remove=function(e){if(be(e))return this.children.isEmpty()?new Dt(null):new Dt(null,this.children);var t=_e(e),n=this.children.get(t);return n?(n=n.remove(ve(e)),e=void 0,e=n.isEmpty()?this.children.remove(t):this.children.insert(t,n),null===this.value&&e.isEmpty()?new Dt(null):new Dt(this.value,e)):this},Dt.prototype.get=function(e){if(be(e))return this.value;var t=_e(e);t=this.children.get(t);return t?t.get(ve(e)):null},Dt.prototype.setTree=function(e,t){if(be(e))return t;var n=_e(e);e=(this.children.get(n)||new Dt(null)).setTree(ve(e),t),t=void 0,t=e.isEmpty()?this.children.remove(n):this.children.insert(n,e);return new Dt(this.value,t)},Dt.prototype.fold=function(e){return this.fold_(fe(),e)},Dt.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal(function(r,i){n[r]=i.fold_(Ce(e,r),t)}),t(e,this.value,n)},Dt.prototype.findOnPath=function(e,t){return this.findOnPath_(e,fe(),t)},Dt.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(be(e))return null;var i=_e(e);r=this.children.get(i);return r?r.findOnPath_(ve(e),Ce(t,i),n):null},Dt.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,fe(),t)},Dt.prototype.foreachOnPath_=function(e,t,n){if(be(e))return this;this.value&&n(t,this.value);var r=_e(e),i=this.children.get(r);return i?i.foreachOnPath_(ve(e),Ce(t,r),n):new Dt(null)},Dt.prototype.foreach=function(e){this.foreach_(fe(),e)},Dt.prototype.foreach_=function(e,t){this.children.inorderTraversal(function(n,r){r.foreach_(Ce(e,n),t)}),this.value&&t(e,this.value)},Dt.prototype.foreachChild=function(e){this.children.inorderTraversal(function(t,n){n.value&&e(t,n.value)})},Dt),ga=(At.empty=function(){return new At(new va(null))},At),ma=(rn.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;Li("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),Li(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,tt(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,et(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,Ze(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw Mi("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,tt(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)},rn.prototype.getChanges=function(){return Array.from(this.changeMap.values())},rn),wa=new(on.prototype.getCompleteChild=function(e){return null},on.prototype.getChildAfterChild=function(e,t,n){return null},on),Ca=(sn.prototype.getCompleteChild=function(e){var t=this.viewCache_.eventCache;return t.isCompleteForChild(e)?t.getNode().getImmediateChild(e):(t=null!=this.optCompleteServerCache_?new _a(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache,en(this.writes_,e,t))},sn.prototype.getChildAfterChild=function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Ot(this.viewCache_);e=Zt(this.writes_,r,t,1,n,e);return 0===e.length?null:e[0]},sn),ba=(Object.defineProperty(fn.prototype,"query",{get:function(){return this.query_},enumerable:!1,configurable:!0}),fn),Ta=function(){this.views=new Map},Ea=1,Ia=function(e){this.listenProvider_=e,this.syncPointTree_=new va(null),this.pendingWriteTree_={visibleWrites:ga.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map},Sa=(Qn.prototype.getImmediateChild=function(e){return new Qn(this.node_.getImmediateChild(e))},Qn.prototype.node=function(){return this.node_},Qn),ka=(Yn.prototype.getImmediateChild=function(e){return e=Ce(this.path_,e),new Yn(this.syncTree_,e)},Yn.prototype.node=function(){return Ln(this.syncTree_,this.path_)},Yn),Pa=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},Na=function(e,t,n){return e&&"object"==typeof e?(Li(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?xa(e[".sv"],t,n):"object"==typeof e[".sv"]?Ra(e[".sv"],t):void Li(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},xa=function(e,t,n){if("timestamp"===e)return n.timestamp;Li(!1,"Unexpected server value: "+e)},Ra=function(e,t,n){return e.hasOwnProperty("increment")||Li(!1,"Unexpected server value: "+JSON.stringify(e,null,2)),e=e.increment,"number"!=typeof e&&Li(!1,"Unexpected increment value: "+e),t=t.node(),Li(null!=t,"Expected ChildrenNode.EMPTY_NODE for nulls"),t.isLeafNode()?(t=t.getValue(),"number"!=typeof t?e:t+e):e},Oa=function(e,t,n,r){return Kn(t,new ka(n,e),r)},Da=function(e,t,n){return Kn(e,new Sa(t),n)},Aa=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n={children:{},childCount:0}),this.name=e=void 0===e?"":e,this.parent=t,this.node=n},La=/[\[\].#$\/\u0000-\u001F\u007F]/,Ma=/[\[\].#$\u0000-\u001F\u007F]/,Fa=10485760,qa=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!z(e)||e&&"object"==typeof e&&C(e,".sv")},Wa=function(e,t,n,r){r&&void 0===t||ja(P(e,"value"),t,n)},ja=function(e,t,n){var r=n instanceof es?new ts(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+Pe(r));if("function"==typeof t)throw new Error(e+"contains a function "+Pe(r)+" with contents = "+t.toString());if(z(t))throw new Error(e+"contains "+t.toString()+" "+Pe(r));if("string"==typeof t&&t.length>Fa/3&&R(t)>Fa)throw new Error(e+"contains a string greater than "+Fa+" utf8 bytes "+Pe(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(K(t,function(t,n){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!nr(t)))throw new Error(e+" contains an invalid key ("+t+") "+Pe(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var s;s=t,0<(t=r).parts_.length&&(t.byteLength_+=1),t.parts_.push(s),t.byteLength_+=R(s),ke(t),ja(e,n,r),n=(t=r).parts_.pop(),t.byteLength_-=R(n),0<t.parts_.length&&--t.byteLength_}),i&&o)throw new Error(e+' contains ".value" child '+Pe(r)+" in addition to actual children.")}},Ua=function(e,t,n,r){if(!(r&&void 0===n||rr(n)))throw new Error(P(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Ba=function(e,t,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),Ua(e,t,n,r)},Va=function(e,t){if(".info"===_e(t))throw new Error(e+" failed = Can't modify data under /.info/")},za=function(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!nr(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&(n=(n=n)&&n.replace(/^\/*\.info(\/|$)/,"/"),!rr(n)))throw new Error(P(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},Ha=function(){this.eventLists_=[],this.recursionDepth_=0},Qa="repo_interrupt",Ya=25,Ka=(cr.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},cr),Ga=function(e,t){var n=$a(e),r=n.namespace;return"firebase.com"===n.domain&&fo(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||fo("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&_o("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),e="ws"===n.scheme||"wss"===n.scheme,{repoInfo:new Ro(n.host,n.secure,r,t,e,"",r!==n.subdomain),path:new es(n.pathString)}},$a=function(e){var t,n,r,i="",s="",a="",u="",l="",h=!0,c="https",p=443;return"string"==typeof e&&(0<=(r=e.indexOf("//"))&&(c=e.substring(0,r-1),e=e.substring(r+2)),-1===(t=e.indexOf("/"))&&(t=e.length),-1===(n=e.indexOf("?"))&&(n=e.length),i=e.substring(0,Math.min(t,n)),t<n&&(u=function(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(t,n))),n=function(e){var t,n,r={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var i=o(e.split("&")),s=i.next();!s.done;s=i.next()){var a,u=s.value;0!==u.length&&(2===(a=u.split("=")).length?r[decodeURIComponent(a[0])]=decodeURIComponent(a[1]):_o("Invalid query segment '"+u+"' in query '"+e+"'"))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}(e.substring(Math.min(e.length,n))),0<=(r=i.indexOf(":"))?(h="https"===c||"wss"===c,p=parseInt(i.substring(r+1),10)):r=i.length,"localhost"===(r=i.slice(0,r)).toLowerCase()?s="localhost":r.split(".").length<=2?s=r:(r=i.indexOf("."),a=i.substring(0,r).toLowerCase(),s=i.substring(r+1),l=a),"ns"in n&&(l=n.ns)),{host:i,port:p,domain:s,subdomain:a,secure:h,scheme:c,pathString:u,namespace:l}},Ja=(Ar.prototype.getPath=function(){var e=this.snapshot.ref;return("value"===this.eventType?e:e.parent)._path},Ar.prototype.getEventType=function(){return this.eventType},Ar.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},Ar.prototype.toString=function(){
return this.getPath().toString()+":"+this.eventType+":"+m(this.snapshot.exportVal())},Ar),Xa=(Lr.prototype.getPath=function(){return this.path},Lr.prototype.getEventType=function(){return"cancel"},Lr.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},Lr.prototype.toString=function(){return this.path.toString()+":cancel"},Lr),Za=(Mr.prototype.onValue=function(e,t){this.snapshotCallback.call(null,e,t)},Mr.prototype.onCancel=function(e){return Li(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)},Object.defineProperty(Mr.prototype,"hasCancelCallback",{get:function(){return!!this.cancelCallback},enumerable:!1,configurable:!0}),Mr.prototype.matches=function(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context},Mr),eu=(Fr.prototype.cancel=function(){var e=new Wi;return wr(this._repo,this._path,e.wrapCallback(function(){})),e.promise},Fr.prototype.remove=function(){Va("OnDisconnect.remove",this._path);var e=new Wi;return Cr(this._repo,this._path,null,e.wrapCallback(function(){})),e.promise},Fr.prototype.set=function(e){Va("OnDisconnect.set",this._path),Wa("OnDisconnect.set",e,this._path,!1);var t=new Wi;return Cr(this._repo,this._path,e,t.wrapCallback(function(){})),t.promise},Fr.prototype.setWithPriority=function(e,t){Va("OnDisconnect.setWithPriority",this._path),Wa("OnDisconnect.setWithPriority",e,this._path,!1),or("OnDisconnect.setWithPriority",t,!1);var n,r,i,o,s=new Wi;return n=this._repo,r=this._path,e=e,t=t,i=s.wrapCallback(function(){}),o=Ye(e,t),n.server_.onDisconnectPut(r.toString(),o.val(!0),function(e,t){"ok"===e&&ft(n.onDisconnect_,r,o),Ir(0,i,e,t)}),s.promise},Fr.prototype.update=function(e){Va("OnDisconnect.update",this._path),ir("OnDisconnect.update",e,this._path,!1);var t=new Wi;return function(e,t,n,r){if(T(n))return co("onDisconnect().update() called with empty data.  Don't do anything."),Ir(0,r,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,function(i,o){"ok"===i&&K(n,function(n,r){r=Ye(r),ft(e.onDisconnect_,Ce(t,n),r)}),Ir(0,r,i,o)})}(this._repo,this._path,e,t.wrapCallback(function(){})),t.promise},Fr),tu=(Object.defineProperty(qr.prototype,"key",{get:function(){return be(this._path)?null:ge(this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(qr.prototype,"ref",{get:function(){return new nu(this._repo,this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(qr.prototype,"_queryIdentifier",{get:function(){var e=ht(this._queryParams);e=mo(e);return"{}"===e?"default":e},enumerable:!1,configurable:!0}),Object.defineProperty(qr.prototype,"_queryObject",{get:function(){return ht(this._queryParams)},enumerable:!1,configurable:!0}),qr.prototype.isEqual=function(e){if(!((e=O(e))instanceof qr))return!1;var t=this._repo===e._repo,n=Ie(this._path,e._path);e=this._queryIdentifier===e._queryIdentifier;return t&&n&&e},qr.prototype.toJSON=function(){return this.toString()},qr.prototype.toString=function(){return this._repo.toString()+function(e){for(var t="",n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)},qr),nu=(n(Br,Js=tu),Object.defineProperty(Br.prototype,"parent",{get:function(){var e=we(this._path);return null===e?null:new Br(this._repo,e)},enumerable:!1,configurable:!0}),Object.defineProperty(Br.prototype,"root",{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e},enumerable:!1,configurable:!0}),Br),ru=(Object.defineProperty(Vr.prototype,"priority",{get:function(){return this._node.getPriority().val()},enumerable:!1,configurable:!0}),Object.defineProperty(Vr.prototype,"key",{get:function(){return this.ref.key},enumerable:!1,configurable:!0}),Object.defineProperty(Vr.prototype,"size",{get:function(){return this._node.numChildren()},enumerable:!1,configurable:!0}),Vr.prototype.child=function(e){var t=new es(e);e=Qr(this.ref,e);return new Vr(this._node.getChild(t),e,Cs)},Vr.prototype.exists=function(){return!this._node.isEmpty()},Vr.prototype.exportVal=function(){return this._node.val(!0)},Vr.prototype.forEach=function(e){var t=this;return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,function(n,r){return e(new Vr(r,Qr(t.ref,n),Cs))})},Vr.prototype.hasChild=function(e){return e=new es(e),!this._node.getChild(e).isEmpty()},Vr.prototype.hasChildren=function(){return!this._node.isLeafNode()&&!this._node.isEmpty()},Vr.prototype.toJSON=function(){return this.exportVal()},Vr.prototype.val=function(){return this._node.val()},Vr),iu=($r.prototype.respondsTo=function(e){return"value"===e},$r.prototype.createEvent=function(e,t){var n=t._queryParams.getIndex();return new Ja("value",this,new ru(e.snapshotNode,new nu(t._repo,t._path),n))},$r.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,null)}},$r.prototype.createCancelEvent=function(e,t){return this.callbackContext.hasCancelCallback?new Xa(this,e,t):null},$r.prototype.matches=function(e){return e instanceof $r&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))},$r.prototype.hasAnyCallback=function(){return null!==this.callbackContext},$r),ou=(Jr.prototype.respondsTo=function(e){return e="children_added"===e?"child_added":e,this.eventType===("children_removed"===e?"child_removed":e)},Jr.prototype.createCancelEvent=function(e,t){return this.callbackContext.hasCancelCallback?new Xa(this,e,t):null},Jr.prototype.createEvent=function(e,t){Li(null!=e.childName,"Child events should have a childName.");var n=Qr(new nu(t._repo,t._path),e.childName);t=t._queryParams.getIndex();return new Ja(e.type,this,new ru(e.snapshotNode,n,t),e.prevName)},Jr.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,e.prevName)}},Jr.prototype.matches=function(e){return e instanceof Jr&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))},Jr.prototype.hasAnyCallback=function(){return!!this.callbackContext},Jr),su=(Go=function(){},n(oi,Xs=Go),oi.prototype._apply=function(e){Wa("endAt",this._value,e._path,!0);var t=at(e._queryParams,this._value,this._key);if(Ur(t),jr(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new tu(e._repo,e._path,t,e._orderByCalled)},oi),au=(n(si,Zs=Go),si.prototype._apply=function(e){Wa("endBefore",this._value,e._path,!1);var t,n,r=(t=e._queryParams,n=this._value,r=this._key,(r=t.index_===as?at(t,n="string"==typeof n?Je(n):n,r):at(t,n,null==r?yo:Je(r))).endBeforeSet_=!0,r);if(Ur(r),jr(r),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new tu(e._repo,e._path,r,e._orderByCalled)},si),uu=(n(ai,ea=Go),ai.prototype._apply=function(e){Wa("startAt",this._value,e._path,!0);var t=st(e._queryParams,this._value,this._key);if(Ur(t),jr(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new tu(e._repo,e._path,t,e._orderByCalled)},ai),lu=(n(ui,ta=Go),ui.prototype._apply=function(e){Wa("startAfter",this._value,e._path,!1);var t,n,r=(t=e._queryParams,n=this._value,r=this._key,(r=t.index_===as?st(t,n="string"==typeof n?$e(n):n,r):st(t,n,null==r?vo:$e(r))).startAfterSet_=!0,r);if(Ur(r),jr(r),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new tu(e._repo,e._path,r,e._orderByCalled)},ui),hu=(n(li,na=Go),li.prototype._apply=function(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new tu(e._repo,e._path,(t=e._queryParams,n=this._limit,(t=t.copy()).limitSet_=!0,t.limit_=n,t.viewFrom_="l",t),e._orderByCalled);var t,n},li),cu=(n(hi,ra=Go),hi.prototype._apply=function(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new tu(e._repo,e._path,(t=e._queryParams,n=this._limit,(t=t.copy()).limitSet_=!0,t.limit_=n,t.viewFrom_="r",t),e._orderByCalled);var t,n},hi),pu=(n(ci,ia=Go),ci.prototype._apply=function(e){Wr(e,"orderByChild");var t=new es(this._path);if(be(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");return t=new Ms(t),t=ut(e._queryParams,t),jr(t),new tu(e._repo,e._path,t,!0)},ci),du=(n(pi,oa=Go),pi.prototype._apply=function(e){Wr(e,"orderByKey");var t=ut(e._queryParams,as);return jr(t),new tu(e._repo,e._path,t,!0)},pi),fu=(n(di,sa=Go),di.prototype._apply=function(e){Wr(e,"orderByPriority");var t=ut(e._queryParams,Cs);return jr(t),new tu(e._repo,e._path,t,!0)},di),_u=(n(fi,aa=Go),fi.prototype._apply=function(e){Wr(e,"orderByValue");var t=ut(e._queryParams,Fs);return jr(t),new tu(e._repo,e._path,t,!0)},fi),yu=(n(_i,ua=Go),_i.prototype._apply=function(e){if(Wa("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new su(this._value,this._key)._apply(new uu(this._value,this._key)._apply(e))},_i);la=nu,Li(!Gs,"__referenceConstructor has already been defined"),Gs=la,ha=nu,Li(!$s,"__referenceConstructor has already been defined"),$s=ha;var vu,gu="FIREBASE_DATABASE_EMULATOR_HOST",mu={},wu=!1,Cu=(Object.defineProperty(gi.prototype,"_repo",{get:function(){return this._instanceStarted||(pr(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal},enumerable:!1,configurable:!0}),Object.defineProperty(gi.prototype,"_root",{get:function(){return this._rootInternal||(this._rootInternal=new nu(this._repo,fe())),this._rootInternal},enumerable:!1,configurable:!0}),gi.prototype._delete=function(){var e,t,n;return null!==this._rootInternal&&(e=this._repo,t=this.app.name,(n=mu[t])&&n[e.key]===e||fo("Database "+t+"("+e.repoInfo_+") has already been deleted."),Tr(e),delete n[e.key],this._repoInternal=null,this._rootInternal=null),Promise.resolve()},gi.prototype._checkNotDeleted=function(e){null===this._rootInternal&&fo("Cannot call "+e+" on a deleted database.")},gi),bu={".sv":"timestamp"},Tu=(Ci.prototype.toJSON=function(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}},Ci),Eu=(Ti.prototype.cancel=function(e){k("OnDisconnect.cancel",0,1,arguments.length),N("OnDisconnect.cancel","onComplete",e,!0);var t=this._delegate.cancel();return e&&t.then(function(){return e(null)},function(t){return e(t)}),t},Ti.prototype.remove=function(e){k("OnDisconnect.remove",0,1,arguments.length),N("OnDisconnect.remove","onComplete",e,!0);var t=this._delegate.remove();return e&&t.then(function(){return e(null)},function(t){return e(t)}),t},Ti.prototype.set=function(e,t){return k("OnDisconnect.set",1,2,arguments.length),N("OnDisconnect.set","onComplete",t,!0),e=this._delegate.set(e),t&&e.then(function(){return t(null)},function(e){return t(e)}),e},Ti.prototype.setWithPriority=function(e,t,n){return k("OnDisconnect.setWithPriority",2,3,arguments.length),N("OnDisconnect.setWithPriority","onComplete",n,!0),t=this._delegate.setWithPriority(e,t),n&&t.then(function(){return n(null)},function(e){return n(e)}),t},Ti.prototype.update=function(e,t){if(k("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,_o("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}N("OnDisconnect.update","onComplete",t,!0);var i=this._delegate.update(e);return t&&i.then(function(){return t(null)},function(e){return t(e)}),i},Ti),Iu=(Ei.prototype.toJSON=function(){return k("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},Ei),Su=(Ii.prototype.val=function(){return k("DataSnapshot.val",0,0,arguments.length),this._delegate.val()},Ii.prototype.exportVal=function(){return k("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()},Ii.prototype.toJSON=function(){return k("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()},Ii.prototype.exists=function(){return k("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()},Ii.prototype.child=function(e){return k("DataSnapshot.child",0,1,arguments.length),e=String(e),Ua("DataSnapshot.child","path",e,!1),new Ii(this._database,this._delegate.child(e))},Ii.prototype.hasChild=function(e){return k("DataSnapshot.hasChild",1,1,arguments.length),Ua("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)},Ii.prototype.getPriority=function(){return k("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority},Ii.prototype.forEach=function(e){var t=this;return k("DataSnapshot.forEach",1,1,arguments.length),N("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(function(n){return e(new Ii(t._database,n))})},Ii.prototype.hasChildren=function(){return k("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()},Object.defineProperty(Ii.prototype,"key",{get:function(){return this._delegate.key},enumerable:!1,configurable:!0}),Ii.prototype.numChildren=function(){return k("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size},Ii.prototype.getRef=function(){return k("DataSnapshot.ref",0,0,arguments.length),new Pu(this._database,this._delegate.ref)},Object.defineProperty(Ii.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),Ii),ku=(Si.prototype.on=function(e,t,n,r){function i(e,n){t.call(s.context,new Su(o.database,e),n)}var o=this;k("Query.on",2,4,arguments.length),N("Query.on","callback",t,!1);var s=Si.getCancelAndContextArgs_("Query.on",n,r);i.userCallback=t,i.context=s.context;var a=null===(r=s.cancel)||void 0===r?void 0:r.bind(s.context);switch(e){case"value":return Zr(this._delegate,i,a),t;case"child_added":return ei(this._delegate,i,a),t;case"child_removed":return ri(this._delegate,i,a),t;case"child_changed":return ti(this._delegate,i,a),t;case"child_moved":return ni(this._delegate,i,a),t;default:throw new Error(P("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},Si.prototype.off=function(e,t,n){var r;k("Query.off",0,3,arguments.length),function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(P(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}("Query.off",e,!0),N("Query.off","callback",t,!0),x("Query.off","context",n,!0),t?((r=function(){}).userCallback=t,r.context=n,ii(this._delegate,e,r)):ii(this._delegate,e)},Si.prototype.get=function(){var e=this;return Gr(this._delegate).then(function(t){return new Su(e.database,t)})},Si.prototype.once=function(e,t,n,r){function i(e,n){e=new Su(s.database,e),t&&t.call(a.context,e,n),u.resolve(e)}function o(e){a.cancel&&a.cancel.call(a.context,e),u.reject(e)}var s=this;k("Query.once",1,4,arguments.length),N("Query.once","callback",t,!0);var a=Si.getCancelAndContextArgs_("Query.once",n,r),u=new Wi;switch(i.userCallback=t,i.context=a.context,e){case"value":Zr(this._delegate,i,o,{onlyOnce:!0});break;case"child_added":ei(this._delegate,i,o,{onlyOnce:!0});break;case"child_removed":ri(this._delegate,i,o,{onlyOnce:!0});break;case"child_changed":ti(this._delegate,i,o,{onlyOnce:!0});break;case"child_moved":ni(this._delegate,i,o,{onlyOnce:!0});break;default:throw new Error(P("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return u.promise},Si.prototype.limitToFirst=function(e){return k("Query.limitToFirst",1,1,arguments.length),new Si(this.database,yi(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new hu(e)}(e)))},Si.prototype.limitToLast=function(e){return k("Query.limitToLast",1,1,arguments.length),new Si(this.database,yi(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new cu(e)}(e)))},Si.prototype.orderByChild=function(e){return k("Query.orderByChild",1,1,arguments.length),new Si(this.database,yi(this._delegate,function(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Ua("orderByChild","path",e,!1),new pu(e)}(e)))},Si.prototype.orderByKey=function(){return k("Query.orderByKey",0,0,arguments.length),new Si(this.database,yi(this._delegate,new du))},Si.prototype.orderByPriority=function(){return k("Query.orderByPriority",0,0,arguments.length),new Si(this.database,yi(this._delegate,new fu))},Si.prototype.orderByValue=function(){return k("Query.orderByValue",0,0,arguments.length),new Si(this.database,yi(this._delegate,new _u))},Si.prototype.startAt=function(e,t){return void 0===e&&(e=null),k("Query.startAt",0,2,arguments.length),new Si(this.database,yi(this._delegate,(void 0===(e=e)&&(e=null),sr("startAt","key",t=t,!0),new uu(e,t))))},Si.prototype.startAfter=function(e,t){return void 0===e&&(e=null),k("Query.startAfter",0,2,arguments.length),new Si(this.database,yi(this._delegate,(e=e,sr("startAfter","key",t=t,!0),new lu(e,t))))},Si.prototype.endAt=function(e,t){return void 0===e&&(e=null),k("Query.endAt",0,2,arguments.length),new Si(this.database,yi(this._delegate,(e=e,sr("endAt","key",t=t,!0),new su(e,t))))},Si.prototype.endBefore=function(e,t){return void 0===e&&(e=null),k("Query.endBefore",0,2,arguments.length),new Si(this.database,yi(this._delegate,(e=e,sr("endBefore","key",t=t,!0),new au(e,t))))},Si.prototype.equalTo=function(e,t){return k("Query.equalTo",1,2,arguments.length),new Si(this.database,yi(this._delegate,(e=e,sr("equalTo","key",t=t,!0),new yu(e,t))))},Si.prototype.toString=function(){return k("Query.toString",0,0,arguments.length),this._delegate.toString()},Si.prototype.toJSON=function(){return k("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()},Si.prototype.isEqual=function(e){if(k("Query.isEqual",1,1,arguments.length),e instanceof Si)return this._delegate.isEqual(e._delegate);throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")},Si.getCancelAndContextArgs_=function(e,t,n){var r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,N(e,"cancel",r.cancel,!0),r.context=n,x(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(P(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r},Object.defineProperty(Si.prototype,"ref",{get:function(){return new Pu(this.database,new nu(this._delegate._repo,this._delegate._path))},enumerable:!1,configurable:!0}),Si),Pu=(n(ki,vu=ku),ki.prototype.getKey=function(){return k("Reference.key",0,0,arguments.length),this._delegate.key},ki.prototype.child=function(e){return k("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new ki(this.database,Qr(this._delegate,e))},ki.prototype.getParent=function(){k("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new ki(this.database,e):null},ki.prototype.getRoot=function(){return k("Reference.root",0,0,arguments.length),new ki(this.database,this._delegate.root)},ki.prototype.set=function(e,t){return k("Reference.set",1,2,arguments.length),N("Reference.set","onComplete",t,!0),e=Yr(this._delegate,e),t&&e.then(function(){return t(null)},function(e){return t(e)}),e},ki.prototype.update=function(e,t){if(k("Reference.update",1,2,arguments.length),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,_o("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Va("Reference.update",this._delegate._path),N("Reference.update","onComplete",t,!0);var i=Kr(this._delegate,e);return t&&i.then(function(){return t(null)},function(e){return t(e)}),i},ki.prototype.setWithPriority=function(e,t,n){return k("Reference.setWithPriority",2,3,arguments.length),N("Reference.setWithPriority","onComplete",n,!0),t=function(e,t,n){if(Va("setWithPriority",e._path),Wa("setWithPriority",t,e._path,!1),or("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";var r=new Wi;return mr(e._repo,e._path,t,n,r.wrapCallback(function(){})),r.promise}(this._delegate,e,t),n&&t.then(function(){return n(null)},function(e){return n(e)}),t},ki.prototype.remove=function(e){k("Reference.remove",0,1,arguments.length),N("Reference.remove","onComplete",e,!0);var t=(t=this._delegate,Va("remove",t._path),Yr(t,null));return e&&t.then(function(){return e(null)},function(t){return e(t)}),t},ki.prototype.transaction=function(e,t,n){var r=this;return k("Reference.transaction",1,3,arguments.length),N("Reference.transaction","transactionUpdate",e,!1),N("Reference.transaction","onComplete",t,!0),function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(P(e,t)+"must be a boolean.")}("Reference.transaction","applyLocally",n,!0),n=bi(this._delegate,e,{applyLocally:n}).then(function(e){return new Iu(e.committed,new Su(r.database,e.snapshot))}),t&&n.then(function(e){return t(null,e.committed,e.snapshot)},function(e){return t(e,!1,null)}),n},ki.prototype.setPriority=function(e,t){return k("Reference.setPriority",1,2,arguments.length),N("Reference.setPriority","onComplete",t,!0),e=function(e,t){e=O(e),Va("setPriority",e._path),or("setPriority",t,!1);var n=new Wi;return mr(e._repo,Ce(e._path,".priority"),t,null,n.wrapCallback(function(){})),n.promise}(this._delegate,e),t&&e.then(function(){return t(null)},function(e){return t(e)}),e},ki.prototype.push=function(e,t){var n=this;k("Reference.push",0,2,arguments.length),N("Reference.push","onComplete",t,!0);var r=function(e,t){e=O(e),Va("push",e._path),Wa("push",t,e._path,!0);var n=dr(e._repo),r=Ws(n),i=(n=Qr(e,r),Qr(e,r));t=null!=t?Yr(i,t).then(function(){return i}):Promise.resolve(i);return n.then=t.then.bind(t),n.catch=t.then.bind(t,void 0),n}(this._delegate,e);e=r.then(function(e){return new ki(n.database,e)});return t&&e.then(function(){return t(null)},function(e){return t(e)}),r=new ki(this.database,r),r.then=e.then.bind(e),r.catch=e.catch.bind(e,void 0),r},ki.prototype.onDisconnect=function(){return Va("Reference.onDisconnect",this._delegate._path),new Eu(new eu(this._delegate._repo,this._delegate._path))},Object.defineProperty(ki.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(ki.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(ki.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),ki),Nu=(Pi.prototype.useEmulator=function(e,t,n){mi(this._delegate,e,t,n=void 0===n?{}:n)},Pi.prototype.ref=function(e){if(k("database.ref",0,1,arguments.length),e instanceof Pu){var t=Hr(this._delegate,e.toString());return new Pu(this,t)}return t=zr(this._delegate,e),new Pu(this,t)},Pi.prototype.refFromURL=function(e){return k("database.refFromURL",1,1,arguments.length),e=Hr(this._delegate,e),new Pu(this,e)},Pi.prototype.goOffline=function(){var e;k("database.goOffline",0,0,arguments.length),(e=O(e=this._delegate))._checkNotDeleted("goOffline"),Tr(e._repo)},Pi.prototype.goOnline=function(){return k("database.goOnline",0,0,arguments.length),wi(this._delegate)},Pi.ServerValue={TIMESTAMP:bu,increment:function(e){return{".sv":{increment:e}}}},Pi),xu=Object.freeze({__proto__:null,forceLongPolling:function(){Qo.forceDisallow(),qo.forceAllow()},forceWebSockets:function(){qo.forceDisallow()},isWebSocketsAvailable:function(){return Qo.isAvailable()},setSecurityDebugCallback:function(e,t){e._delegate._repo.persistentConnection_.securityDebugCallback_=t},stats:function(e,t){var n;e=e._delegate._repo,void 0===(t=t)&&(t=!1),"undefined"!=typeof console&&(e=t?(e.statsListener_||(e.statsListener_=new Qs(e.stats_)),e.statsListener_.get()):e.stats_.get(),n=Object.keys(e).reduce(function(e,t){return Math.max(t.length,e)},0),K(e,function(e,t){for(var r=e,i=e.length;i<n+2;i++)r+=" ";console.log(r+t)}))},statsIncrementCounter:function(e,t){e=e._delegate._repo,t=t,e.stats_.incrementCounter(t),e.statsReporter_.statsToReport_[t]=!0},dataUpdateCount:function(e){return e._delegate._repo.dataUpdateCount},interceptServerData:function(e,t){e._delegate._repo.interceptServerDataCallback_=t},initStandalone:function(e){var t=e.app,n=e.url,r=e.version,i=e.customAuthImpl,o=e.namespace;e=void 0!==(e=e.nodeAdmin)&&e;return q(r),(r=new Yi("auth-internal",new Ki("database-standalone"))).setComponent(new Hi("auth-internal",function(){return i},"PRIVATE")),{instance:new Nu(vi(t,r,void 0,n,e),t),namespace:o}}});Go=os;os.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},os.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var Ru,Ou=Object.freeze({__proto__:null,DataConnection:Go,RealTimeConnection:Ko,hijackHash:function(e){var t=os.prototype.put;return os.prototype.put=function(n,r,i,o){void 0!==o&&(o=e()),t.call(this,n,r,i,o)},function(){os.prototype.put=t}},ConnectionTarget:Ro,queryIdentifier:function(e){return e._delegate._queryIdentifier},forceRestClient:function(e){wu=e}}),Du=Nu.ServerValue;q((Ru=Ri.default).SDK_VERSION),Ru.INTERNAL.registerComponent(new Hi("database",function(e,t){var n=t.instanceIdentifier,r=e.getProvider("app").getImmediate();t=e.getProvider("auth-internal"),e=e.getProvider("app-check-internal");return new Nu(vi(r,t,e,n),r)},"PUBLIC").setServiceProps({Reference:Pu,Query:ku,Database:Nu,DataSnapshot:Su,enableLogging:B,INTERNAL:xu,ServerValue:Du,TEST_ACCESS:Ou}).setMultipleInstances(!0)),Ru.registerVersion("@firebase/database","0.11.0")}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-database.js - be sure to load firebase-app.js first.")}});